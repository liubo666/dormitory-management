import{s as e}from"./index-BbXepoDv.js";/* empty css                *//* empty css                             *//* empty css                       *//* empty css                        *//* empty css                     *//* empty css                 *//* empty css                             */import{_ as l}from"./_plugin-vue_export-helper-g1HmYxY9.js";/* empty css               */import{x as a,j as t,R as u,e as d,ac as r,f as o,P as s,M as n,c as i,d as p,T as c,ab as m,V as f,W as v,J as _,H as b,X as y,Y as h,Z as g,$ as V,a2 as w,a3 as k,a4 as x,ah as U,ai as j,a6 as z,a as C,G as N,a7 as I,a5 as T,U as R}from"./element-CivdSU1D.js";import{y as Y,r as P,l as $,j as q,z as D,B as M,R as O,O as B,J as F,u as J,Q as S,a5 as A,K as G,I as H,P as K,L,A as Q}from"./vendor-D1RP7qex.js";import"./utils-BstTJ5dP.js";const W={class:"repair-management"},X={class:"page-header"},Z={class:"page-title"},E={class:"page-actions"},ee={class:"search-container"},le={class:"table-container"},ae={class:"pagination-container"},te={class:"dialog-footer"},ue={class:"dialog-footer"},de={class:"dialog-footer"},re=l(Y({__name:"index",setup(l){const Y=P(!1),re=P(!1),oe=P([]),se=P(null),ne=$({current:1,size:10,roomNo:"",studentName:"",type:"",status:void 0,priority:void 0}),ie=$({current:1,size:10,total:0}),pe=P([]),ce=[{label:"水电维修",value:"water"},{label:"电路维修",value:"electric"},{label:"门窗维修",value:"door"},{label:"家具维修",value:"furniture"},{label:"其他",value:"other"}],me=[{label:"待处理",value:1,type:"warning"},{label:"处理中",value:2,type:"primary"},{label:"已完成",value:3,type:"success"},{label:"已取消",value:4,type:"info"}],fe=[{label:"低",value:1,type:"info"},{label:"中",value:2,type:"warning"},{label:"高",value:3,type:"danger"}],ve=P([]),_e=P([]),be=P(!1),ye=P(!1),he=P(!1),ge=P(),Ve=P(),we=$({roomId:null,studentId:null,title:"",description:"",type:"",priority:2,contactPhone:"",images:[]}),ke=$({id:0,status:2,handleRemark:""}),xe={roomId:[{required:!0,message:"请选择宿舍",trigger:"change"}],studentId:[{required:!0,message:"请选择报修学生",trigger:"change"}],title:[{required:!0,message:"请输入报修标题",trigger:"blur"}],type:[{required:!0,message:"请选择报修类型",trigger:"change"}]},Ue={status:[{required:!0,message:"请选择处理结果",trigger:"change"}]},je=e=>{switch(e){case 1:return"warning";case 2:return"primary";case 3:return"success";default:return"info"}},ze=e=>{switch(e){case 1:default:return"info";case 2:return"warning";case 3:return"danger"}},Ce=async()=>{Y.value=!0;try{const l={...ne,current:ie.current,size:ie.size,startDate:pe.value[0]||"",endDate:pe.value[1]||""},a=await function(l){return e({url:"/repair/page",method:"post",data:l})}(l);oe.value=a.records,ie.total=a.total}catch(l){C.error("获取数据失败")}finally{Y.value=!1}},Ne=()=>{ie.current=1,Ce()},Ie=()=>{Object.assign(ne,{current:1,size:10,roomNo:"",studentName:"",type:"",status:void 0,priority:void 0}),pe.value=[],ie.current=1,Ce()},Te=e=>{ie.size=e,ie.current=1,Ce()},Re=e=>{ie.current=e,Ce()},Ye=async()=>{try{const a=await e({url:"/repair/dormitories/options",method:"get"});ve.value=a.map(e=>({label:`${e.buildingName} ${e.roomNo}`,value:e.id}));const t=await e({url:"/repair/students/options",method:"get",params:{keyword:l}});_e.value=t.map(e=>({label:`${e.name} (${e.studentNo})`,value:e.id})),be.value=!0}catch(a){C.error(a.message||"加载选项失败")}var l},Pe=async()=>{ge.value&&await ge.value.validate(async l=>{if(l){re.value=!0;try{await(a=we,e({url:"/repair",method:"post",data:a})),C.success("新增报修成功"),be.value=!1,Object.assign(we,{roomId:0,studentId:0,title:"",description:"",type:"",priority:2,contactPhone:"",images:[]}),Ce()}catch(t){C.error(t.message||"新增报修失败")}finally{re.value=!1}}var a})},$e=async()=>{Ve.value&&se.value&&await Ve.value.validate(async l=>{if(l){re.value=!0;try{await(a=ke,e({url:"/repair/handle",method:"post",data:a})),C.success("处理报修成功"),ye.value=!1,Ce()}catch(t){C.error(t.message||"处理报修失败")}finally{re.value=!1}}var a})},qe=l=>{N.confirm("确定要删除该报修记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(a=l.id,e({url:`/repair/${a}`,method:"delete"})),C.success("删除成功"),Ce()}catch(t){C.error(t.message||"删除失败")}var a})},De=async l=>{try{const t=await(a=l.id,e({url:`/repair/${a}`,method:"get"}));se.value=t,he.value=!0}catch(t){C.error(t.message||"获取详情失败")}var a};return q(()=>{Ce()}),(e,l)=>{const C=t,N=d,P=p,$=i,q=n,Me=R,Oe=c,Be=s,Fe=m,Je=o,Se=_,Ae=y,Ge=h,He=g,Ke=I,Le=k,Qe=x,We=j,Xe=U,Ze=z,Ee=T,el=b;return Q(),D("div",W,[M("div",X,[M("div",Z,[M("h2",null,[O(C,null,{default:F(()=>[O(J(a))]),_:1}),l[23]||(l[23]=B(" 报修管理 ",-1))]),l[24]||(l[24]=M("p",null,"管理宿舍报修信息，包括报修申请、处理进度等",-1))]),M("div",E,[O(N,{type:"primary",onClick:Ye},{default:F(()=>[O(C,null,{default:F(()=>[O(J(u))]),_:1}),l[25]||(l[25]=B(" 新增报修 ",-1))]),_:1}),O(N,{onClick:Ce},{default:F(()=>[O(C,null,{default:F(()=>[O(J(r))]),_:1}),l[26]||(l[26]=B(" 刷新 ",-1))]),_:1})])]),M("div",ee,[O(Se,{shadow:"never"},{default:F(()=>[O(Je,{model:ne,"label-width":"80px"},{default:F(()=>[O(Be,{gutter:20},{default:F(()=>[O(q,{span:6},{default:F(()=>[O($,{label:"宿舍号"},{default:F(()=>[O(P,{modelValue:ne.roomNo,"onUpdate:modelValue":l[0]||(l[0]=e=>ne.roomNo=e),placeholder:"请输入宿舍号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),O(q,{span:6},{default:F(()=>[O($,{label:"学生姓名"},{default:F(()=>[O(P,{modelValue:ne.studentName,"onUpdate:modelValue":l[1]||(l[1]=e=>ne.studentName=e),placeholder:"请输入学生姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),O(q,{span:6},{default:F(()=>[O($,{label:"报修类型"},{default:F(()=>[O(Oe,{modelValue:ne.type,"onUpdate:modelValue":l[2]||(l[2]=e=>ne.type=e),placeholder:"请选择报修类型",clearable:"",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(J(ce),e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),O(q,{span:6},{default:F(()=>[O($,{label:"优先级"},{default:F(()=>[O(Oe,{modelValue:ne.priority,"onUpdate:modelValue":l[3]||(l[3]=e=>ne.priority=e),placeholder:"请选择优先级",clearable:"",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(J(fe),e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),O(Be,{gutter:20},{default:F(()=>[O(q,{span:8},{default:F(()=>[O($,{label:"状态"},{default:F(()=>[O(Oe,{modelValue:ne.status,"onUpdate:modelValue":l[4]||(l[4]=e=>ne.status=e),placeholder:"请选择状态",clearable:"",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(J(me),e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),O(q,{span:10},{default:F(()=>[O($,{label:"报修时间"},{default:F(()=>[O(Fe,{modelValue:pe.value,"onUpdate:modelValue":l[5]||(l[5]=e=>pe.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),O(q,{span:6},{default:F(()=>[O($,null,{default:F(()=>[O(N,{type:"primary",onClick:Ne,loading:Y.value},{default:F(()=>[O(C,null,{default:F(()=>[O(J(f))]),_:1}),l[27]||(l[27]=B(" 搜索 ",-1))]),_:1},8,["loading"]),O(N,{onClick:Ie},{default:F(()=>[O(C,null,{default:F(()=>[O(J(v))]),_:1}),l[28]||(l[28]=B(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),M("div",le,[O(Se,{shadow:"never"},{default:F(()=>[G((Q(),H(Ke,{data:oe.value,stripe:"",border:"",style:{width:"100%"}},{default:F(()=>[O(Ae,{prop:"title",label:"报修标题","min-width":"200","show-overflow-tooltip":""}),O(Ae,{prop:"roomNo",label:"宿舍号",width:"100"}),O(Ae,{prop:"buildingName",label:"楼栋",width:"100"}),O(Ae,{prop:"studentName",label:"报修人",width:"120"}),O(Ae,{prop:"typeText",label:"报修类型",width:"120"}),O(Ae,{prop:"priorityText",label:"优先级",width:"100",align:"center"},{default:F(({row:e})=>[O(Ge,{type:ze(e.priority),size:"small"},{default:F(()=>[B(K(e.priorityText),1)]),_:2},1032,["type"])]),_:1}),O(Ae,{prop:"reportTime",label:"报修时间",width:"180"}),O(Ae,{prop:"status",label:"状态",width:"100",align:"center"},{default:F(({row:e})=>[O(Ge,{type:je(e.status)},{default:F(()=>[B(K(e.statusText),1)]),_:2},1032,["type"])]),_:1}),O(Ae,{label:"操作",width:"200",fixed:"right"},{default:F(({row:e})=>[O(He,null,{default:F(()=>[O(N,{size:"small",onClick:l=>De(e)},{default:F(()=>[O(C,null,{default:F(()=>[O(J(V))]),_:1}),l[29]||(l[29]=B(" 详情 ",-1))]),_:1},8,["onClick"]),1===e.status?(Q(),H(N,{key:0,size:"small",type:"primary",onClick:l=>(e=>{se.value=e,Object.assign(ke,{id:e.id,status:2,handleRemark:""}),ye.value=!0})(e)},{default:F(()=>[O(C,null,{default:F(()=>[O(J(a))]),_:1}),l[30]||(l[30]=B(" 处理 ",-1))]),_:1},8,["onClick"])):L("",!0),O(N,{size:"small",type:"danger",onClick:l=>qe(e)},{default:F(()=>[O(C,null,{default:F(()=>[O(J(w))]),_:1}),l[31]||(l[31]=B(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[el,Y.value]]),M("div",ae,[O(Le,{"current-page":ie.current,"onUpdate:currentPage":l[6]||(l[6]=e=>ie.current=e),"page-size":ie.size,"onUpdate:pageSize":l[7]||(l[7]=e=>ie.size=e),"page-sizes":[10,20,50,100],total:ie.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Te,onCurrentChange:Re},null,8,["current-page","page-size","total"])])]),_:1})]),O(Qe,{modelValue:be.value,"onUpdate:modelValue":l[16]||(l[16]=e=>be.value=e),title:"新增报修",width:"800px","close-on-click-modal":!1},{footer:F(()=>[M("span",te,[O(N,{onClick:l[15]||(l[15]=e=>be.value=!1)},{default:F(()=>[...l[32]||(l[32]=[B("取消",-1)])]),_:1}),O(N,{type:"primary",onClick:Pe,loading:re.value},{default:F(()=>[...l[33]||(l[33]=[B(" 提交 ",-1)])]),_:1},8,["loading"])])]),default:F(()=>[O(Je,{model:we,rules:xe,ref_key:"addFormRef",ref:ge,"label-width":"100px","label-position":"right"},{default:F(()=>[O(Be,{gutter:20},{default:F(()=>[O(q,{span:12},{default:F(()=>[O($,{label:"宿舍",prop:"roomId"},{default:F(()=>[O(Oe,{modelValue:we.roomId,"onUpdate:modelValue":l[8]||(l[8]=e=>we.roomId=e),placeholder:"请选择宿舍",filterable:"",clearable:"",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(ve.value,e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),O(q,{span:12},{default:F(()=>[O($,{label:"报修人",prop:"studentId"},{default:F(()=>[O(Oe,{modelValue:we.studentId,"onUpdate:modelValue":l[9]||(l[9]=e=>we.studentId=e),placeholder:"请选择报修人",filterable:"",clearable:"",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(_e.value,e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),O(Be,{gutter:20},{default:F(()=>[O(q,{span:24},{default:F(()=>[O($,{label:"报修标题",prop:"title"},{default:F(()=>[O(P,{modelValue:we.title,"onUpdate:modelValue":l[10]||(l[10]=e=>we.title=e),placeholder:"请输入报修标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),O(Be,{gutter:20},{default:F(()=>[O(q,{span:12},{default:F(()=>[O($,{label:"报修类型",prop:"type"},{default:F(()=>[O(Oe,{modelValue:we.type,"onUpdate:modelValue":l[11]||(l[11]=e=>we.type=e),placeholder:"请选择报修类型",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(J(ce),e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),O(q,{span:12},{default:F(()=>[O($,{label:"优先级",prop:"priority"},{default:F(()=>[O(Oe,{modelValue:we.priority,"onUpdate:modelValue":l[12]||(l[12]=e=>we.priority=e),placeholder:"请选择优先级",style:{width:"100%"}},{default:F(()=>[(Q(!0),D(S,null,A(J(fe),e=>(Q(),H(Me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),O(Be,{gutter:20},{default:F(()=>[O(q,{span:12},{default:F(()=>[O($,{label:"联系电话"},{default:F(()=>[O(P,{modelValue:we.contactPhone,"onUpdate:modelValue":l[13]||(l[13]=e=>we.contactPhone=e),placeholder:"请输入联系电话",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),O(Be,{gutter:20},{default:F(()=>[O(q,{span:24},{default:F(()=>[O($,{label:"报修描述"},{default:F(()=>[O(P,{modelValue:we.description,"onUpdate:modelValue":l[14]||(l[14]=e=>we.description=e),type:"textarea",rows:3,placeholder:"请输入报修描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),O(Qe,{modelValue:ye.value,"onUpdate:modelValue":l[20]||(l[20]=e=>ye.value=e),title:"处理报修",width:"500px","close-on-click-modal":!1},{footer:F(()=>[M("span",ue,[O(N,{onClick:l[19]||(l[19]=e=>ye.value=!1)},{default:F(()=>[...l[37]||(l[37]=[B("取消",-1)])]),_:1}),O(N,{type:"primary",onClick:$e,loading:re.value},{default:F(()=>[...l[38]||(l[38]=[B(" 确认处理 ",-1)])]),_:1},8,["loading"])])]),default:F(()=>[O(Je,{model:ke,rules:Ue,ref_key:"processFormRef",ref:Ve,"label-width":"100px"},{default:F(()=>[O($,{label:"报修标题"},{default:F(()=>{var e;return[O(P,{value:null==(e=se.value)?void 0:e.title,disabled:""},null,8,["value"])]}),_:1}),O($,{label:"处理结果",prop:"status"},{default:F(()=>[O(Xe,{modelValue:ke.status,"onUpdate:modelValue":l[17]||(l[17]=e=>ke.status=e)},{default:F(()=>[O(We,{value:2},{default:F(()=>[...l[34]||(l[34]=[B("处理中",-1)])]),_:1}),O(We,{value:3},{default:F(()=>[...l[35]||(l[35]=[B("已完成",-1)])]),_:1}),O(We,{value:4},{default:F(()=>[...l[36]||(l[36]=[B("已取消",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),O($,{label:"处理备注"},{default:F(()=>[O(P,{modelValue:ke.handleRemark,"onUpdate:modelValue":l[18]||(l[18]=e=>ke.handleRemark=e),type:"textarea",rows:3,placeholder:"请输入处理备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),O(Qe,{modelValue:he.value,"onUpdate:modelValue":l[22]||(l[22]=e=>he.value=e),title:"报修详情",width:"800px"},{footer:F(()=>[M("span",de,[O(N,{onClick:l[21]||(l[21]=e=>he.value=!1)},{default:F(()=>[...l[39]||(l[39]=[B("关闭",-1)])]),_:1})])]),default:F(()=>[se.value?(Q(),H(Ee,{key:0,column:2,border:""},{default:F(()=>[O(Ze,{label:"报修标题"},{default:F(()=>[B(K(se.value.title),1)]),_:1}),O(Ze,{label:"宿舍号"},{default:F(()=>[B(K(se.value.buildingName)+" "+K(se.value.roomNo),1)]),_:1}),O(Ze,{label:"报修人"},{default:F(()=>[B(K(se.value.studentName),1)]),_:1}),O(Ze,{label:"联系电话"},{default:F(()=>[B(K(se.value.contactPhone||"无"),1)]),_:1}),O(Ze,{label:"报修类型"},{default:F(()=>[B(K(se.value.typeText),1)]),_:1}),O(Ze,{label:"优先级"},{default:F(()=>[O(Ge,{type:ze(se.value.priority)},{default:F(()=>[B(K(se.value.priorityText),1)]),_:1},8,["type"])]),_:1}),O(Ze,{label:"状态"},{default:F(()=>[O(Ge,{type:je(se.value.status)},{default:F(()=>[B(K(se.value.statusText),1)]),_:1},8,["type"])]),_:1}),O(Ze,{label:"报修时间"},{default:F(()=>[B(K(se.value.reportTime),1)]),_:1}),O(Ze,{label:"处理人"},{default:F(()=>[B(K(se.value.handlerName||"未处理"),1)]),_:1}),O(Ze,{label:"处理时间"},{default:F(()=>[B(K(se.value.handleTime||"未处理"),1)]),_:1}),O(Ze,{label:"完成时间"},{default:F(()=>[B(K(se.value.completeTime||"未完成"),1)]),_:1}),O(Ze,{label:"报修描述",span:2},{default:F(()=>[B(K(se.value.description||"无"),1)]),_:1}),O(Ze,{label:"处理备注",span:2},{default:F(()=>[B(K(se.value.handleRemark||"无"),1)]),_:1})]),_:1})):L("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-11716d66"]]);export{re as default};
