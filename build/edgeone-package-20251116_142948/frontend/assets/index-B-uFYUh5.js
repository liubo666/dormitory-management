import"./index-BbXepoDv.js";/* empty css                *//* empty css                             *//* empty css                        *//* empty css                     *//* empty css                 *//* empty css                             */import{_ as e}from"./_plugin-vue_export-helper-g1HmYxY9.js";/* empty css               */import{u as a,j as l,R as t,e as u,f as i,P as s,M as r,c as o,d,T as n,ab as m,V as v,W as c,J as p,H as f,X as _,Y as b,Z as g,$ as h,_ as y,w as N,aj as V,a2 as w,a3 as T,a4 as k,a6 as x,a as C,G as S,a7 as P,a5 as I,U as z}from"./element-CivdSU1D.js";import{g as j,a as U,s as Y,b as A,c as D,d as $,e as M,f as B,u as H,h as q}from"./visitor-BE84VSQc.js";import{y as O,r as R,l as J,j as G,z as K,B as L,R as Q,O as W,J as X,u as Z,Q as E,a5 as F,K as ee,I as ae,P as le,L as te,A as ue}from"./vendor-D1RP7qex.js";import"./utils-BstTJ5dP.js";const ie={class:"visitor-management"},se={class:"page-header"},re={class:"page-title"},oe={class:"page-actions"},de={class:"content-container"},ne={class:"search-section"},me={class:"table-section"},ve={class:"pagination-container"},ce={class:"dialog-footer"},pe=e(O({__name:"index",setup(e){const O=R(!1),pe=R(!1),fe=R([]),_e=R(!1),be=R(!1),ge=R(!1),he=R(null),ye=R([]),Ne=R([]),Ve=R(null),we=R(null),Te=R(!1),ke=R(!1),xe=[{label:"待访问",value:0},{label:"访问中",value:1},{label:"已完成",value:2},{label:"已取消",value:3}],Ce=J({current:1,size:10,visitorName:"",visitorPhone:"",status:void 0,startDate:"",endDate:""}),Se=R([]),Pe=J({current:1,size:10,total:0}),Ie=J({visitorName:"",visitorPhone:"",visitorIdCard:"",visitStudentName:"",visitStudentNo:"",roomId:null,visitPurpose:"",expectedVisitTime:"",actualArrivalTime:"",leaveTime:"",status:0,remarks:""}),ze=R(),je={visitorName:[{required:!0,message:"请输入访客姓名",trigger:"blur"}],visitorPhone:[{required:!0,message:"请输入访客手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],roomId:[{required:!0,message:"请选择访问宿舍",trigger:"change"}],expectedVisitTime:[{required:!0,message:"请选择预计访问时间",trigger:"change"}]},Ue=e=>e?e.substring(0,19).replace("T"," "):"",Ye=e=>{switch(e){case 0:default:return"info";case 1:return"success";case 2:return"primary";case 3:return"danger"}},Ae=async()=>{O.value=!0;try{const e={...Ce,current:Pe.current,size:Pe.size,startDate:Se.value[0]||"",endDate:Se.value[1]||""},a=await j(e);fe.value=a.records,Pe.total=a.total}catch(e){C.error("获取数据失败")}finally{O.value=!1}},De=async e=>{ke.value=!0;try{const a={keyword:e||"",current:1,size:20},l=await Y(a);let t=[];l&&l.records?t=l.records:Array.isArray(l)?t=l:l&&Array.isArray(l.data)&&(t=l.data),ye.value=t.map(e=>({label:`${e.buildingName} ${e.roomNo}`,value:e.id,buildingName:e.buildingName,roomNo:e.roomNo}))}catch(a){ye.value=[]}finally{ke.value=!1}},$e=async e=>{Te.value=!0;try{const a={keyword:e||"",current:1,size:20},l=await A(a);let t=[];l&&l.records?t=l.records:Array.isArray(l)?t=l:l&&Array.isArray(l.data)&&(t=l.data),Ne.value=t.map(e=>({label:`${e.studentNo} - ${e.name}`,value:e.id,studentNo:e.studentNo,name:e.name}))}catch(a){Ne.value=[]}finally{Te.value=!1}},Me=e=>{const a=ye.value.find(a=>a.value===e);Ie.roomId=a?e:null},Be=e=>{const a=Ne.value.find(a=>a.value===e);a?(Ie.visitStudentName=a.name,Ie.visitStudentNo=a.studentNo):(Ie.visitStudentName="",Ie.visitStudentNo="")},He=()=>{Pe.current=1,Ae()},qe=()=>{Object.assign(Ce,{current:1,size:10,visitorName:"",visitorPhone:"",status:void 0,startDate:"",endDate:""}),Se.value=[],Pe.current=1,Ae()},Oe=e=>{Pe.size=e,Pe.current=1,Ae()},Re=e=>{Pe.current=e,Ae()},Je=async()=>{ge.value=!1,Ve.value=null,we.value=null,Ne.value=[],ye.value=[],Object.assign(Ie,{visitorName:"",visitorPhone:"",visitorIdCard:"",visitStudentName:"",visitStudentNo:"",roomId:null,visitPurpose:"",expectedVisitTime:"",actualArrivalTime:"",leaveTime:"",status:0,remarks:""}),_e.value=!0,await Promise.all([$e(""),De("")])},Ge=async()=>{if(ze.value)try{await ze.value.validate(),pe.value=!0;const e={...Ie,roomId:Ie.roomId?String(Ie.roomId):null};ge.value?(await H(e),C.success("更新成功")):(await q(e),C.success("添加成功")),_e.value=!1,Ae()}catch(e){"cancel"!==e&&C.error(ge.value?"更新失败":"添加失败")}finally{pe.value=!1}};return G(()=>{Ae(),(async()=>{try{const e=await U();ye.value=e.map(e=>({label:e.label,value:e.value}))}catch(e){}})()}),(e,j)=>{const U=l,Y=u,A=d,H=o,q=r,R=z,J=n,G=s,Ke=m,Le=i,Qe=p,We=_,Xe=b,Ze=g,Ee=P,Fe=T,ea=k,aa=x,la=I,ta=f;return ue(),K("div",ie,[L("div",se,[L("div",re,[L("h2",null,[Q(U,null,{default:X(()=>[Q(Z(a))]),_:1}),j[19]||(j[19]=W(" 访客登记 ",-1))]),j[20]||(j[20]=L("p",null,"管理访客登记信息，包括来访登记、签到签退等",-1))]),L("div",oe,[Q(Y,{type:"primary",onClick:Je,size:"large"},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(t))]),_:1}),j[21]||(j[21]=W(" 新增访客 ",-1))]),_:1})])]),L("div",de,[L("div",ne,[Q(Qe,{shadow:"never"},{default:X(()=>[Q(Le,{model:Ce,"label-width":"80px"},{default:X(()=>[Q(G,{gutter:20},{default:X(()=>[Q(q,{span:6},{default:X(()=>[Q(H,{label:"访客姓名"},{default:X(()=>[Q(A,{modelValue:Ce.visitorName,"onUpdate:modelValue":j[0]||(j[0]=e=>Ce.visitorName=e),placeholder:"请输入访客姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),Q(q,{span:6},{default:X(()=>[Q(H,{label:"访客手机"},{default:X(()=>[Q(A,{modelValue:Ce.visitorPhone,"onUpdate:modelValue":j[1]||(j[1]=e=>Ce.visitorPhone=e),placeholder:"请输入访客手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),Q(q,{span:6},{default:X(()=>[Q(H,{label:"访问状态"},{default:X(()=>[Q(J,{modelValue:Ce.status,"onUpdate:modelValue":j[2]||(j[2]=e=>Ce.status=e),placeholder:"请选择状态",clearable:"",style:{width:"100%"}},{default:X(()=>[(ue(),K(E,null,F(xe,e=>Q(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Q(G,{gutter:20},{default:X(()=>[Q(q,{span:8},{default:X(()=>[Q(H,{label:"访问日期"},{default:X(()=>[Q(Ke,{modelValue:Se.value,"onUpdate:modelValue":j[3]||(j[3]=e=>Se.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),Q(q,{span:16},{default:X(()=>[Q(H,null,{default:X(()=>[Q(Y,{type:"primary",onClick:He,loading:O.value},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(v))]),_:1}),j[22]||(j[22]=W(" 搜索 ",-1))]),_:1},8,["loading"]),Q(Y,{onClick:qe},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(c))]),_:1}),j[23]||(j[23]=W(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),L("div",me,[Q(Qe,{shadow:"never"},{default:X(()=>[ee((ue(),ae(Ee,{data:fe.value,stripe:"",border:"",style:{width:"100%"}},{default:X(()=>[Q(We,{prop:"visitorName",label:"访客姓名",width:"100"}),Q(We,{prop:"visitorPhone",label:"访客手机",width:"120"}),Q(We,{prop:"visitStudentName",label:"被访学生",width:"100"}),Q(We,{prop:"roomNo",label:"宿舍号",width:"100"}),Q(We,{prop:"buildingName",label:"楼栋",width:"120"}),Q(We,{prop:"expectedVisitTime",label:"预计访问时间",width:"160"},{default:X(({row:e})=>[W(le(Ue(e.expectedVisitTime)),1)]),_:1}),Q(We,{prop:"statusText",label:"状态",width:"100",align:"center"},{default:X(({row:e})=>[Q(Xe,{type:Ye(e.status)},{default:X(()=>[W(le(e.statusText),1)]),_:2},1032,["type"])]),_:1}),Q(We,{prop:"registrarName",label:"登记人",width:"120"}),Q(We,{label:"操作",width:"280",fixed:"right"},{default:X(({row:e})=>[Q(Ze,null,{default:X(()=>[Q(Y,{size:"small",onClick:a=>(async e=>{try{const a=await D(e.id);he.value=a,be.value=!0}catch(a){C.error("获取详情失败")}})(e)},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(h))]),_:1}),j[24]||(j[24]=W(" 详情 ",-1))]),_:1},8,["onClick"]),Q(Y,{size:"small",type:"primary",onClick:a=>(async e=>{ge.value=!0,Ve.value=null,we.value=null,Ne.value=[],ye.value=[],await Promise.all([$e(""),De("")]);try{const a=await D(e.id);a.roomId&&(we.value=a.roomId,ye.value.find(e=>e.value===a.roomId)||ye.value.unshift({label:`${a.buildingName||""} ${a.roomNo||""}`.trim(),value:a.roomId,buildingName:a.buildingName||"",roomNo:a.roomNo||""})),a.visitStudentName&&a.visitStudentNo&&(Ne.value.find(e=>e.studentNo===a.visitStudentNo&&e.name===a.visitStudentName)||Ne.value.unshift({label:`${a.visitStudentNo} - ${a.visitStudentName}`,value:0,studentNo:a.visitStudentNo,name:a.visitStudentName}),Ve.value=0),Object.assign(Ie,{id:a.id,visitorName:a.visitorName,visitorPhone:a.visitorPhone,visitorIdCard:a.visitorIdCard||"",visitStudentName:a.visitStudentName,visitStudentNo:a.visitStudentNo||"",roomId:a.roomId,visitPurpose:a.visitPurpose||"",expectedVisitTime:a.expectedVisitTime?a.expectedVisitTime.substring(0,19).replace("T"," "):"",actualArrivalTime:a.actualArrivalTime?a.actualArrivalTime.substring(0,19).replace("T"," "):"",leaveTime:a.leaveTime?a.leaveTime.substring(0,19).replace("T"," "):"",status:a.status,remarks:a.remarks||""}),_e.value=!0}catch(a){C.error("获取详情失败")}})(e)},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(y))]),_:1}),j[25]||(j[25]=W(" 编辑 ",-1))]),_:1},8,["onClick"]),Q(Y,{size:"small",type:"success",onClick:a=>(async e=>{try{await S.confirm("确定要为该访客签到吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await M(e.id),C.success("签到成功"),Ae()}catch(a){"cancel"!==a&&C.error("签到失败")}})(e),disabled:0!==e.status},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(N))]),_:1}),j[26]||(j[26]=W(" 签到 ",-1))]),_:1},8,["onClick","disabled"]),Q(Y,{size:"small",type:"warning",onClick:a=>(async e=>{try{await S.confirm("确定要为该访客签退吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await B(e.id),C.success("签退成功"),Ae()}catch(a){"cancel"!==a&&C.error("签退失败")}})(e),disabled:1!==e.status},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(V))]),_:1}),j[27]||(j[27]=W(" 签退 ",-1))]),_:1},8,["onClick","disabled"]),Q(Y,{size:"small",type:"danger",onClick:a=>(async e=>{try{await S.confirm("确定要删除这条访客记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $(e.id),C.success("删除成功"),Ae()}catch(a){"cancel"!==a&&C.error("删除失败")}})(e)},{default:X(()=>[Q(U,null,{default:X(()=>[Q(Z(w))]),_:1}),j[28]||(j[28]=W(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ta,O.value]]),L("div",ve,[Q(Fe,{"current-page":Pe.current,"onUpdate:currentPage":j[4]||(j[4]=e=>Pe.current=e),"page-size":Pe.size,"onUpdate:pageSize":j[5]||(j[5]=e=>Pe.size=e),"page-sizes":[10,20,50,100],total:Pe.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Oe,onCurrentChange:Re},null,8,["current-page","page-size","total"])])]),_:1})])]),Q(ea,{modelValue:_e.value,"onUpdate:modelValue":j[16]||(j[16]=e=>_e.value=e),title:ge.value?"编辑访客登记":"新增访客登记",width:"800px","close-on-click-modal":!1},{footer:X(()=>[L("span",ce,[Q(Y,{onClick:j[15]||(j[15]=e=>_e.value=!1)},{default:X(()=>[...j[29]||(j[29]=[W("取消",-1)])]),_:1}),Q(Y,{type:"primary",onClick:Ge,loading:pe.value},{default:X(()=>[W(le(ge.value?"更新":"提交"),1)]),_:1},8,["loading"])])]),default:X(()=>[Q(Le,{model:Ie,rules:je,ref_key:"formRef",ref:ze,"label-width":"100px","label-position":"right"},{default:X(()=>[Q(G,{gutter:20},{default:X(()=>[Q(q,{span:12},{default:X(()=>[Q(H,{label:"访客姓名",prop:"visitorName"},{default:X(()=>[Q(A,{modelValue:Ie.visitorName,"onUpdate:modelValue":j[6]||(j[6]=e=>Ie.visitorName=e),placeholder:"请输入访客姓名"},null,8,["modelValue"])]),_:1})]),_:1}),Q(q,{span:12},{default:X(()=>[Q(H,{label:"访客手机",prop:"visitorPhone"},{default:X(()=>[Q(A,{modelValue:Ie.visitorPhone,"onUpdate:modelValue":j[7]||(j[7]=e=>Ie.visitorPhone=e),placeholder:"请输入访客手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Q(G,{gutter:20},{default:X(()=>[Q(q,{span:8},{default:X(()=>[Q(H,{label:"身份证号",prop:"visitorIdCard"},{default:X(()=>[Q(A,{modelValue:Ie.visitorIdCard,"onUpdate:modelValue":j[8]||(j[8]=e=>Ie.visitorIdCard=e),placeholder:"请输入身份证号"},null,8,["modelValue"])]),_:1})]),_:1}),Q(q,{span:16},{default:X(()=>[Q(H,{label:"被访学生",prop:"visitStudentName"},{default:X(()=>[Q(J,{modelValue:Ve.value,"onUpdate:modelValue":j[9]||(j[9]=e=>Ve.value=e),placeholder:"请选择或搜索学生",filterable:"",remote:"","remote-method":$e,loading:Te.value,style:{width:"100%"},onChange:Be},{default:X(()=>[(ue(!0),K(E,null,F(Ne.value,e=>(ue(),ae(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),Q(G,{gutter:20},{default:X(()=>[Q(q,{span:12},{default:X(()=>[Q(H,{label:"访问宿舍",prop:"roomId"},{default:X(()=>[Q(J,{modelValue:we.value,"onUpdate:modelValue":j[10]||(j[10]=e=>we.value=e),placeholder:"请选择或搜索宿舍",filterable:"",remote:"","remote-method":De,loading:ke.value,clearable:"",style:{width:"100%"},onChange:Me},{default:X(()=>[(ue(!0),K(E,null,F(ye.value,e=>(ue(),ae(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),Q(q,{span:12},{default:X(()=>[Q(H,{label:"预计访问时间",prop:"expectedVisitTime"},{default:X(()=>[Q(Ke,{modelValue:Ie.expectedVisitTime,"onUpdate:modelValue":j[11]||(j[11]=e=>Ie.expectedVisitTime=e),type:"datetime",placeholder:"请选择预计访问时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Q(G,{gutter:20},{default:X(()=>[Q(q,{span:12},{default:X(()=>[Q(H,{label:"访问状态",prop:"status"},{default:X(()=>[Q(J,{modelValue:Ie.status,"onUpdate:modelValue":j[12]||(j[12]=e=>Ie.status=e),placeholder:"请选择状态",style:{width:"100%"}},{default:X(()=>[(ue(),K(E,null,F(xe,e=>Q(R,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Q(G,null,{default:X(()=>[Q(q,{span:24},{default:X(()=>[Q(H,{label:"访问事由"},{default:X(()=>[Q(A,{modelValue:Ie.visitPurpose,"onUpdate:modelValue":j[13]||(j[13]=e=>Ie.visitPurpose=e),type:"textarea",rows:3,placeholder:"请输入访问事由"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Q(G,null,{default:X(()=>[Q(q,{span:24},{default:X(()=>[Q(H,{label:"备注"},{default:X(()=>[Q(A,{modelValue:Ie.remarks,"onUpdate:modelValue":j[14]||(j[14]=e=>Ie.remarks=e),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),Q(ea,{modelValue:be.value,"onUpdate:modelValue":j[18]||(j[18]=e=>be.value=e),title:"访客登记详情",width:"600px"},{footer:X(()=>[Q(Y,{onClick:j[17]||(j[17]=e=>be.value=!1)},{default:X(()=>[...j[30]||(j[30]=[W("关闭",-1)])]),_:1})]),default:X(()=>[he.value?(ue(),ae(la,{key:0,column:2,border:""},{default:X(()=>[Q(aa,{label:"访客姓名"},{default:X(()=>[W(le(he.value.visitorName),1)]),_:1}),Q(aa,{label:"访客手机"},{default:X(()=>[W(le(he.value.visitorPhone),1)]),_:1}),Q(aa,{label:"身份证号"},{default:X(()=>[W(le(he.value.visitorIdCard||"无"),1)]),_:1}),Q(aa,{label:"被访学生"},{default:X(()=>[W(le(he.value.visitStudentName),1)]),_:1}),Q(aa,{label:"学生学号"},{default:X(()=>[W(le(he.value.visitStudentNo||"无"),1)]),_:1}),Q(aa,{label:"宿舍号"},{default:X(()=>[W(le(he.value.roomNo),1)]),_:1}),Q(aa,{label:"楼栋"},{default:X(()=>[W(le(he.value.buildingName),1)]),_:1}),Q(aa,{label:"访问状态"},{default:X(()=>[Q(Xe,{type:Ye(he.value.status)},{default:X(()=>[W(le(he.value.statusText),1)]),_:1},8,["type"])]),_:1}),Q(aa,{label:"预计访问时间"},{default:X(()=>[W(le(Ue(he.value.expectedVisitTime)),1)]),_:1}),Q(aa,{label:"实际到达时间"},{default:X(()=>[W(le(Ue(he.value.actualArrivalTime)||"无"),1)]),_:1}),Q(aa,{label:"离开时间"},{default:X(()=>[W(le(Ue(he.value.leaveTime)||"无"),1)]),_:1}),Q(aa,{label:"登记人"},{default:X(()=>[W(le(he.value.registrarName||"无"),1)]),_:1}),Q(aa,{label:"访问事由",span:"2"},{default:X(()=>[W(le(he.value.visitPurpose||"无"),1)]),_:1}),Q(aa,{label:"备注",span:"2"},{default:X(()=>[W(le(he.value.remarks||"无"),1)]),_:1})]),_:1})):te("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-25eaffa7"]]);export{pe as default};
