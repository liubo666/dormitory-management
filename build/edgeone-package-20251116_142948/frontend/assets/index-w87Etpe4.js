import{s as e}from"./index-BbXepoDv.js";/* empty css                *//* empty css                             *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css                     *//* empty css                             */import{_ as l}from"./_plugin-vue_export-helper-g1HmYxY9.js";/* empty css               */import{y as a,j as t,R as o,e as u,f as r,P as s,M as n,c as d,d as i,T as c,ab as p,V as m,W as f,J as v,H as _,X as g,Y as b,Z as h,$ as y,_ as w,a2 as V,a3 as k,S as D,a4 as x,a6 as j,a as z,G as C,a7 as Y,a5 as U,U as I}from"./element-CivdSU1D.js";import{y as N,r as M,l as T,j as H,z as S,B as $,R as q,O,J as B,u as P,Q as R,a5 as J,K as L,I as A,P as G,L as K,A as Q}from"./vendor-D1RP7qex.js";import"./utils-BstTJ5dP.js";function W(l){return e({url:`/inspection/${l}`,method:"get"})}function X(e){return{excellent:"success",good:"primary",pass:"warning",fail:"danger"}[e]||"info"}const Z={class:"inspection-management"},E={class:"page-header"},F={class:"page-title"},ee={class:"page-actions"},le={class:"content-container"},ae={class:"search-section"},te={class:"table-section"},oe={class:"pagination-container"},ue={class:"dialog-footer"},re=l(N({__name:"index",setup(l){const N=M(!1),re=M(!1),se=M([]),ne=M(!1),de=M(!1),ie=M(!1),ce=M(null),pe=M([]),me=[{label:"优秀",value:"excellent",type:"success"},{label:"良好",value:"good",type:"primary"},{label:"合格",value:"pass",type:"warning"},{label:"不合格",value:"fail",type:"danger"}],fe=T({current:1,size:10,roomNo:"",roomId:void 0,level:"",startDate:"",endDate:""}),ve=M([]),_e=T({current:1,size:10,total:0}),ge=T({roomId:null,inspectionDate:"",score:null,level:"",remarks:"",issues:"",images:[]}),be=M(),he={roomId:[{required:!0,message:"请选择宿舍",trigger:"change"}],inspectionDate:[{required:!0,message:"请选择检查日期",trigger:"change"}],score:[{required:!0,message:"请输入卫生分数",trigger:"blur"}],level:[{required:!0,message:"请选择检查等级",trigger:"change"}]},ye=e=>e?e.substring(0,19).replace("T"," "):"",we=async()=>{N.value=!0;try{const l={...fe,current:_e.current,size:_e.size,startDate:ve.value[0]||"",endDate:ve.value[1]||""},a=await function(l){return e({url:"/inspection/page",method:"post",data:l})}(l);se.value=a.records,_e.total=a.total}catch(l){z.error("获取数据失败")}finally{N.value=!1}},Ve=async()=>{try{const l=await e({url:"/inspection/dormitories/options",method:"get"});pe.value=l.map(e=>({label:`${e.buildingName||""} ${e.roomNo}`,value:e.id}))}catch(l){}},ke=()=>{_e.current=1,we()},De=()=>{Object.assign(fe,{current:1,size:10,roomNo:"",roomId:void 0,level:"",minScore:void 0,maxScore:void 0,startDate:"",endDate:""}),ve.value=[],_e.current=1,we()},xe=e=>{_e.size=e,_e.current=1,we()},je=e=>{_e.current=e,we()},ze=()=>{ie.value=!1,Object.assign(ge,{roomId:null,inspectionDate:"",score:null,level:"",remarks:"",issues:"",images:[]}),ne.value=!0},Ce=async l=>{try{await C.confirm("确定要删除这条检查记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await(a=l.id,e({url:`/inspection/${a}`,method:"delete"})),z.success("删除成功"),we()}catch(t){"cancel"!==t&&z.error("删除失败")}var a},Ye=()=>{},Ue=e=>{null!=e&&(ge.level=function(e){return e>=90?"excellent":e>=80?"good":e>=60?"pass":"fail"}(e))},Ie=async()=>{var l;if(be.value)try{await be.value.validate(),re.value=!0,ie.value?(await(l=ge,e({url:"/inspection",method:"put",data:l})),z.success("更新成功")):(await function(l){return e({url:"/inspection",method:"post",data:l})}(ge),z.success("添加成功")),ne.value=!1,we()}catch(a){"cancel"!==a&&z.error(ie.value?"更新失败":"添加失败")}finally{re.value=!1}};return H(()=>{we(),Ve()}),(e,l)=>{const C=t,M=u,T=i,H=d,we=n,Ve=I,Ne=c,Me=s,Te=p,He=r,Se=v,$e=g,qe=b,Oe=h,Be=Y,Pe=k,Re=D,Je=x,Le=j,Ae=U,Ge=_;return Q(),S("div",Z,[$("div",E,[$("div",F,[$("h2",null,[q(C,null,{default:B(()=>[q(P(a))]),_:1}),l[16]||(l[16]=O(" 卫生检查 ",-1))]),l[17]||(l[17]=$("p",null,"管理宿舍卫生检查记录，包括检查评分、等级评定等",-1))]),$("div",ee,[q(M,{type:"primary",onClick:ze,size:"large"},{default:B(()=>[q(C,null,{default:B(()=>[q(P(o))]),_:1}),l[18]||(l[18]=O(" 新增检查 ",-1))]),_:1})])]),$("div",le,[$("div",ae,[q(Se,{shadow:"never"},{default:B(()=>[q(He,{model:fe,"label-width":"80px"},{default:B(()=>[q(Me,{gutter:20},{default:B(()=>[q(we,{span:6},{default:B(()=>[q(H,{label:"宿舍号"},{default:B(()=>[q(T,{modelValue:fe.roomNo,"onUpdate:modelValue":l[0]||(l[0]=e=>fe.roomNo=e),placeholder:"请输入宿舍号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),q(we,{span:6},{default:B(()=>[q(H,{label:"宿舍"},{default:B(()=>[q(Ne,{modelValue:fe.roomId,"onUpdate:modelValue":l[1]||(l[1]=e=>fe.roomId=e),placeholder:"请选择宿舍",clearable:"",filterable:"",style:{width:"100%"}},{default:B(()=>[(Q(!0),S(R,null,J(pe.value,e=>(Q(),A(Ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),q(we,{span:6},{default:B(()=>[q(H,{label:"检查等级"},{default:B(()=>[q(Ne,{modelValue:fe.level,"onUpdate:modelValue":l[2]||(l[2]=e=>fe.level=e),placeholder:"请选择等级",clearable:"",style:{width:"100%"}},{default:B(()=>[(Q(!0),S(R,null,J(P(me),e=>(Q(),A(Ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),q(Me,{gutter:20},{default:B(()=>[q(we,{span:8},{default:B(()=>[q(H,{label:"检查日期"},{default:B(()=>[q(Te,{modelValue:ve.value,"onUpdate:modelValue":l[3]||(l[3]=e=>ve.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),q(we,{span:16},{default:B(()=>[q(H,null,{default:B(()=>[q(M,{type:"primary",onClick:ke,loading:N.value},{default:B(()=>[q(C,null,{default:B(()=>[q(P(m))]),_:1}),l[19]||(l[19]=O(" 搜索 ",-1))]),_:1},8,["loading"]),q(M,{onClick:De},{default:B(()=>[q(C,null,{default:B(()=>[q(P(f))]),_:1}),l[20]||(l[20]=O(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),$("div",te,[q(Se,{shadow:"never"},{default:B(()=>[L((Q(),A(Be,{data:se.value,stripe:"",border:"",style:{width:"100%"}},{default:B(()=>[q($e,{prop:"roomNo",label:"宿舍号",width:"100"}),q($e,{prop:"buildingName",label:"楼栋",width:"120"}),q($e,{prop:"inspectionDate",label:"检查日期",width:"120"},{default:B(({row:e})=>[O(G(ye(e.inspectionDate)),1)]),_:1}),q($e,{prop:"score",label:"卫生分数",width:"100",align:"center"},{default:B(({row:e})=>{return[q(qe,{type:(l=e.score,l>=90?"success":l>=80?"primary":l>=60?"warning":"danger")},{default:B(()=>[O(G(e.score)+"分 ",1)]),_:2},1032,["type"])];var l}),_:1}),q($e,{prop:"levelText",label:"等级",width:"100",align:"center"},{default:B(({row:e})=>[q(qe,{type:P(X)(e.level)},{default:B(()=>[O(G(e.levelText),1)]),_:2},1032,["type"])]),_:1}),q($e,{prop:"inspectorName",label:"检查人",width:"120"}),q($e,{prop:"remarks",label:"备注","min-width":"200","show-overflow-tooltip":""}),q($e,{label:"操作",width:"200",fixed:"right"},{default:B(({row:e})=>[q(Oe,null,{default:B(()=>[q(M,{size:"small",onClick:l=>(async e=>{try{const l=await W(e.id);ce.value=l,de.value=!0}catch(l){z.error("获取详情失败")}})(e)},{default:B(()=>[q(C,null,{default:B(()=>[q(P(y))]),_:1}),l[21]||(l[21]=O(" 详情 ",-1))]),_:1},8,["onClick"]),q(M,{size:"small",type:"primary",onClick:l=>(async e=>{ie.value=!0;try{const l=await W(e.id);Object.assign(ge,{id:l.id,roomId:l.roomId,inspectionDate:l.inspectionDate,score:l.score,level:l.level,remarks:l.remarks||"",issues:l.issues||"",images:l.imageList||[]}),ne.value=!0}catch(l){z.error("获取详情失败")}})(e)},{default:B(()=>[q(C,null,{default:B(()=>[q(P(w))]),_:1}),l[22]||(l[22]=O(" 编辑 ",-1))]),_:1},8,["onClick"]),q(M,{size:"small",type:"danger",onClick:l=>Ce(e)},{default:B(()=>[q(C,null,{default:B(()=>[q(P(V))]),_:1}),l[23]||(l[23]=O(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ge,N.value]]),$("div",oe,[q(Pe,{"current-page":_e.current,"onUpdate:currentPage":l[4]||(l[4]=e=>_e.current=e),"page-size":_e.size,"onUpdate:pageSize":l[5]||(l[5]=e=>_e.size=e),"page-sizes":[10,20,50,100],total:_e.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:xe,onCurrentChange:je},null,8,["current-page","page-size","total"])])]),_:1})])]),q(Je,{modelValue:ne.value,"onUpdate:modelValue":l[13]||(l[13]=e=>ne.value=e),title:ie.value?"编辑检查记录":"新增检查记录",width:"800px","close-on-click-modal":!1},{footer:B(()=>[$("span",ue,[q(M,{onClick:l[12]||(l[12]=e=>ne.value=!1)},{default:B(()=>[...l[24]||(l[24]=[O("取消",-1)])]),_:1}),q(M,{type:"primary",onClick:Ie,loading:re.value},{default:B(()=>[O(G(ie.value?"更新":"提交"),1)]),_:1},8,["loading"])])]),default:B(()=>[q(He,{model:ge,rules:he,ref_key:"formRef",ref:be,"label-width":"100px","label-position":"right"},{default:B(()=>[q(Me,{gutter:20},{default:B(()=>[q(we,{span:12},{default:B(()=>[q(H,{label:"宿舍",prop:"roomId"},{default:B(()=>[q(Ne,{modelValue:ge.roomId,"onUpdate:modelValue":l[6]||(l[6]=e=>ge.roomId=e),placeholder:"请选择宿舍",filterable:"",clearable:"",style:{width:"100%"},onChange:Ye},{default:B(()=>[(Q(!0),S(R,null,J(pe.value,e=>(Q(),A(Ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),q(we,{span:12},{default:B(()=>[q(H,{label:"检查日期",prop:"inspectionDate"},{default:B(()=>[q(Te,{modelValue:ge.inspectionDate,"onUpdate:modelValue":l[7]||(l[7]=e=>ge.inspectionDate=e),type:"datetime",placeholder:"请选择检查日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),q(Me,{gutter:20},{default:B(()=>[q(we,{span:12},{default:B(()=>[q(H,{label:"卫生分数",prop:"score"},{default:B(()=>[q(Re,{modelValue:ge.score,"onUpdate:modelValue":l[8]||(l[8]=e=>ge.score=e),min:0,max:100,placeholder:"请输入卫生分数",style:{width:"100%"},onChange:Ue},null,8,["modelValue"])]),_:1})]),_:1}),q(we,{span:12},{default:B(()=>[q(H,{label:"检查等级",prop:"level"},{default:B(()=>[q(Ne,{modelValue:ge.level,"onUpdate:modelValue":l[9]||(l[9]=e=>ge.level=e),placeholder:"请选择等级",style:{width:"100%"}},{default:B(()=>[(Q(!0),S(R,null,J(P(me),e=>(Q(),A(Ve,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),q(Me,null,{default:B(()=>[q(we,{span:24},{default:B(()=>[q(H,{label:"备注"},{default:B(()=>[q(T,{modelValue:ge.remarks,"onUpdate:modelValue":l[10]||(l[10]=e=>ge.remarks=e),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),q(Me,null,{default:B(()=>[q(we,{span:24},{default:B(()=>[q(H,{label:"问题描述"},{default:B(()=>[q(T,{modelValue:ge.issues,"onUpdate:modelValue":l[11]||(l[11]=e=>ge.issues=e),type:"textarea",rows:3,placeholder:"请输入详细问题描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),q(Je,{modelValue:de.value,"onUpdate:modelValue":l[15]||(l[15]=e=>de.value=e),title:"检查记录详情",width:"600px"},{footer:B(()=>[q(M,{onClick:l[14]||(l[14]=e=>de.value=!1)},{default:B(()=>[...l[25]||(l[25]=[O("关闭",-1)])]),_:1})]),default:B(()=>[ce.value?(Q(),A(Ae,{key:0,column:2,border:""},{default:B(()=>[q(Le,{label:"宿舍号"},{default:B(()=>[O(G(ce.value.roomNo),1)]),_:1}),q(Le,{label:"楼栋"},{default:B(()=>[O(G(ce.value.buildingName),1)]),_:1}),q(Le,{label:"检查日期"},{default:B(()=>[O(G(ye(ce.value.inspectionDate)),1)]),_:1}),q(Le,{label:"卫生分数"},{default:B(()=>[O(G(ce.value.score)+"分",1)]),_:1}),q(Le,{label:"检查等级"},{default:B(()=>[q(qe,{type:P(X)(ce.value.level)},{default:B(()=>[O(G(ce.value.levelText),1)]),_:1},8,["type"])]),_:1}),q(Le,{label:"检查人"},{default:B(()=>[O(G(ce.value.inspectorName),1)]),_:1}),q(Le,{label:"备注",span:"2"},{default:B(()=>[O(G(ce.value.remarks||"无"),1)]),_:1}),q(Le,{label:"问题描述",span:"2"},{default:B(()=>[O(G(ce.value.issues||"无"),1)]),_:1})]),_:1})):K("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-7faf5beb"]]);export{re as default};
