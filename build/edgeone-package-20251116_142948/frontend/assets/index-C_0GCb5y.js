import{s as e}from"./index-BbXepoDv.js";/* empty css                *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css                     *//* empty css                             */import{_ as a}from"./_plugin-vue_export-helper-g1HmYxY9.js";import{N as l,j as t,R as u,e as o,ak as d,ae as n,al as s,J as r,f as i,c as m,d as c,T as p,ab as v,V as f,W as b,H as y,X as g,Y as h,Z as _,$ as N,_ as w,a2 as V,a3 as k,S as C,a4 as $,a as T,G as x,a7 as Y,U as D}from"./element-CivdSU1D.js";import{b as z,s as U}from"./visitor-BE84VSQc.js";import{y as I,r as j,l as A,j as F,z as M,B as S,R as P,O as B,J as q,u as O,P as R,Q as E,a5 as J,K as G,I as H,L as K,A as L}from"./vendor-D1RP7qex.js";import"./utils-BstTJ5dP.js";const Q=[{value:1,label:"住宿费"},{value:2,label:"水电费"},{value:3,label:"网费"},{value:4,label:"其他费用"}],W=[{value:1,label:"按月"},{value:2,label:"按学期"},{value:3,label:"按年"},{value:4,label:"一次性"}],X=[{value:0,label:"未支付",type:"danger"},{value:1,label:"部分支付",type:"warning"},{value:2,label:"已支付",type:"success"}],Z={class:"fee-management"},ee={class:"page-header"},ae={class:"page-title"},le={class:"page-actions"},te={class:"statistics-section"},ue={class:"statistics-cards"},oe={class:"stat-card"},de={class:"stat-icon total"},ne={class:"stat-content"},se={class:"stat-value"},re={class:"stat-card"},ie={class:"stat-icon amount"},me={class:"stat-content"},ce={class:"stat-value"},pe={class:"stat-card"},ve={class:"stat-icon paid"},fe={class:"stat-content"},be={class:"stat-value"},ye={class:"stat-card"},ge={class:"stat-icon unpaid"},he={class:"stat-content"},_e={class:"stat-value"},Ne={class:"content-container"},we={class:"search-section"},Ve={class:"table-section"},ke={class:"amount-text"},Ce={class:"paid-amount"},$e={class:"unpaid-amount"},Te={class:"table-footer"},xe={class:"pagination-section"},Ye={class:"dialog-footer"},De=a(I({__name:"index",setup(a){const I=j(!1),De=j(!1),ze=j([]),Ue=j({totalCount:0,totalAmount:0,totalPaidAmount:0,totalUnpaidAmount:0,unpaidCount:0,partiallyPaidCount:0,fullyPaidCount:0}),Ie=A({current:1,size:10}),je=A({current:1,size:10,total:0}),Ae=j(null),Fe=j(!1),Me=j(!1),Se=j([]),Pe=j([]),Be=j(!1),qe=j(""),Oe=j(),Re=j(!1),Ee=j(""),Je=A({feeType:void 0,feeName:"",description:"",amount:void 0,billingCycle:void 0,studentName:"",studentNo:"",roomId:"",roomNo:"",buildingId:"",buildingName:"",startTime:"",endTime:"",dueDate:"",remark:""}),Ge=j(null),He={feeType:[{required:!0,message:"请选择费用类型",trigger:"change"}],feeName:[{required:!0,message:"请输入费用名称",trigger:"blur"},{min:2,max:50,message:"费用名称长度在 2 到 50 个字符",trigger:"blur"}],amount:[{required:!0,message:"请输入费用金额",trigger:"blur"},{type:"number",min:0,message:"费用金额必须大于等于0",trigger:"blur"}],billingCycle:[{required:!0,message:"请选择计费周期",trigger:"change"}]},Ke=e=>{switch(e){case 1:return"warning";case 2:return"primary";case 3:return"success";default:return"info"}},Le=e=>{switch(e){case 0:return"danger";case 1:return"warning";case 2:return"success";default:return"info"}},Qe=async()=>{var a,l;I.value=!0;try{const t={...Ie,startDate:null==(a=Ae.value)?void 0:a[0],endDate:null==(l=Ae.value)?void 0:l[1],current:je.current,size:je.size},u=await(a=>e({url:"/api/fees/page",method:"post",data:a}))(t);u&&u.records?(ze.value=u.records,je.total=u.total||0):Array.isArray(u)?(ze.value=u,je.total=u.length):(ze.value=[],je.total=0)}catch(t){T.error("获取费用列表失败"),ze.value=[],je.total=0}finally{I.value=!1}},We=async()=>{var a,l;try{const t={...Ie,startDate:null==(a=Ae.value)?void 0:a[0],endDate:null==(l=Ae.value)?void 0:l[1]},u=await(a=>e({url:"/api/fees/statistics",method:"post",data:a}))(t);u&&(Ue.value=u)}catch(t){}},Xe=()=>{je.current=1,Qe(),We()},Ze=()=>{Object.keys(Ie).forEach(e=>{"current"!==e&&"size"!==e&&(Ie[e]=void 0)}),Ae.value=null,Xe()},ea=e=>{je.current=e,Qe()},aa=e=>{je.size=e,je.current=1,Qe()},la=()=>{Re.value=!1,qe.value="新增费用",da(),Be.value=!0},ta=async a=>{Re.value=!0,qe.value="编辑费用",Ee.value=a.id;try{I.value=!0;const t=await(l=a.id,e({url:`/api/fees/${l}`,method:"get"}));t&&(Je.feeType=t.feeType,Je.feeName=t.feeName||"",Je.description=t.description||"",Je.amount=t.amount,Je.billingCycle=t.billingCycle,Je.studentId=t.studentId,Je.studentName=t.studentName||"",Je.studentNo=t.studentNo||"",Je.roomId=t.roomId,Je.roomNo=t.roomNo||"",Je.buildingId=t.roomId,Je.buildingName=t.buildingName||"",Je.startTime=t.startTime||"",Je.endTime=t.endTime||"",Je.dueDate=t.dueDate||"",Je.remark=t.remark||"",t.startTime&&t.endTime&&(Ge.value=[t.startTime,t.endTime]),t.studentId&&t.studentName&&t.studentNo&&(Se.value=[{label:`${t.studentNo} - ${t.studentName}`,value:t.studentId}]),t.roomId&&(t.buildingName||t.roomNo)&&(Pe.value=[{label:`${t.buildingName||""} ${t.roomNo||""}`.trim(),value:t.roomId}])),Be.value=!0}catch(t){T.error("获取费用详情失败")}finally{I.value=!1}var l},ua=async a=>{var l,t;try{await x.confirm(`确认要标记费用"${a.feeName}"为已支付吗？金额：¥${(null==(l=a.amount)?void 0:l.toFixed(2))||"0.00"}`,"确认支付",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});await(t=a.id,e({url:`/api/fees/${t}/paid`,method:"put"}))&&(T.success("支付成功"),Qe(),We())}catch(u){"cancel"!==u&&T.error("支付失败")}},oa=async a=>{var l,t;try{await x.confirm(`确认要删除费用"${a.feeName}"吗？金额：¥${(null==(l=a.amount)?void 0:l.toFixed(2))||"0.00"}`,"确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});await(t=a.id,e({url:`/api/fees/${t}`,method:"delete"}))&&(T.success("删除成功"),Qe(),We())}catch(u){"cancel"!==u&&T.error("删除失败")}},da=()=>{Object.keys(Je).forEach(e=>{Je[e]=""}),Je.feeType=void 0,Je.billingCycle=void 0,Je.amount=void 0,Ge.value=null,Ee.value="",Se.value=[],Pe.value=[]},na=()=>{var e;da(),null==(e=Oe.value)||e.resetFields()},sa=async e=>{Fe.value=!0;try{const a=await z({keyword:e,current:1,size:20});a&&a.records?Se.value=a.records.map(e=>({label:`${e.studentNo} - ${e.name}`,value:e.id})):Array.isArray(a)?Se.value=a.map(e=>({label:`${e.studentNo} - ${e.name}`,value:e.id})):Se.value=[]}catch(a){Se.value=[]}finally{Fe.value=!1}},ra=async e=>{Me.value=!0;try{const a=await U({keyword:e,current:1,size:20});a&&a.records?Pe.value=a.records.map(e=>({label:`${e.buildingName} ${e.roomNo}`,value:e.id})):Array.isArray(a)?Pe.value=a.map(e=>({label:`${e.buildingName} ${e.roomNo}`,value:e.id})):Pe.value=[]}catch(a){Pe.value=[]}finally{Me.value=!1}},ia=e=>{if(!e)return Je.studentName="",void(Je.studentNo="");const a=Se.value.find(a=>a.value===e);if(a){const e=a.label.match(/^(.+?) - (.+)$/);e&&(Je.studentNo=e[1],Je.studentName=e[2])}},ma=e=>{if(!e)return Je.roomNo="",Je.buildingName="",void(Je.buildingId="");const a=Pe.value.find(a=>a.value===e);if(a){const l=a.label.match(/^(.+?) (.+)$/);l&&(Je.buildingName=l[1],Je.roomNo=l[2]),Je.buildingId=e}},ca=async()=>{var a,l,t,u;if(Oe.value)try{await Oe.value.validate(),De.value=!0;const o={...Je,startTime:null==(a=Ge.value)?void 0:a[0],endTime:null==(l=Ge.value)?void 0:l[1]};let d;d=Re.value?await(t=Ee.value,u=o,e({url:`/api/fees/update/${t}`,method:"put",data:u})):await(a=>e({url:"/api/fees/add",method:"post",data:a}))(o),d&&(T.success(Re.value?"更新成功":"创建成功"),Be.value=!1,Qe(),We())}catch(o){T.error(Re.value?"更新失败":"创建失败")}finally{De.value=!1}};return F(()=>{Qe(),We()}),(e,a)=>{const x=t,z=o,U=r,j=c,A=m,F=D,Re=p,Ee=v,Qe=i,We=g,da=h,pa=_,va=Y,fa=k,ba=C,ya=$,ga=y;return L(),M("div",Z,[S("div",ee,[S("div",ae,[S("h2",null,[P(x,null,{default:q(()=>[P(O(l))]),_:1}),a[22]||(a[22]=B(" 费用管理 ",-1))]),a[23]||(a[23]=S("p",null,"管理宿舍费用信息，包括住宿费、水电费、网费等",-1))]),S("div",le,[P(z,{type:"primary",onClick:la,size:"large"},{default:q(()=>[P(x,null,{default:q(()=>[P(O(u))]),_:1}),a[24]||(a[24]=B(" 新增费用 ",-1))]),_:1})])]),S("div",te,[P(U,{shadow:"never",class:"statistics-card"},{default:q(()=>{var e;return[S("div",ue,[S("div",oe,[S("div",de,[P(x,null,{default:q(()=>[P(O(d))]),_:1})]),S("div",ne,[S("div",se,R(Ue.value.totalCount),1),a[25]||(a[25]=S("div",{class:"stat-label"},"总费用数",-1))])]),S("div",re,[S("div",ie,[P(x,null,{default:q(()=>[P(O(l))]),_:1})]),S("div",me,[S("div",ce,"¥"+R((null==(e=Ue.value.totalAmount)?void 0:e.toFixed(2))||"0.00"),1),a[26]||(a[26]=S("div",{class:"stat-label"},"总费用金额",-1))])]),S("div",pe,[S("div",ve,[P(x,null,{default:q(()=>[P(O(n))]),_:1})]),S("div",fe,[S("div",be,R(Ue.value.fullyPaidCount),1),a[27]||(a[27]=S("div",{class:"stat-label"},"已支付",-1))])]),S("div",ye,[S("div",ge,[P(x,null,{default:q(()=>[P(O(s))]),_:1})]),S("div",he,[S("div",_e,R(Ue.value.unpaidCount),1),a[28]||(a[28]=S("div",{class:"stat-label"},"未支付",-1))])])])]}),_:1})]),S("div",Ne,[S("div",we,[P(U,{shadow:"never"},{default:q(()=>[P(Qe,{model:Ie,inline:"",class:"search-form"},{default:q(()=>[P(A,{label:"费用名称"},{default:q(()=>[P(j,{modelValue:Ie.feeName,"onUpdate:modelValue":a[0]||(a[0]=e=>Ie.feeName=e),placeholder:"请输入费用名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),P(A,{label:"费用类型"},{default:q(()=>[P(Re,{modelValue:Ie.feeType,"onUpdate:modelValue":a[1]||(a[1]=e=>Ie.feeType=e),placeholder:"请选择费用类型",clearable:"",style:{width:"150px"}},{default:q(()=>[(L(!0),M(E,null,J(O(Q),e=>(L(),H(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),P(A,{label:"学生姓名"},{default:q(()=>[P(j,{modelValue:Ie.studentName,"onUpdate:modelValue":a[2]||(a[2]=e=>Ie.studentName=e),placeholder:"请输入学生姓名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),P(A,{label:"宿舍号"},{default:q(()=>[P(j,{modelValue:Ie.roomNo,"onUpdate:modelValue":a[3]||(a[3]=e=>Ie.roomNo=e),placeholder:"请输入宿舍号",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),P(A,{label:"支付状态"},{default:q(()=>[P(Re,{modelValue:Ie.paymentStatus,"onUpdate:modelValue":a[4]||(a[4]=e=>Ie.paymentStatus=e),placeholder:"请选择支付状态",clearable:"",style:{width:"130px"}},{default:q(()=>[(L(!0),M(E,null,J(O(X),e=>(L(),H(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),P(A,{label:"日期范围"},{default:q(()=>[P(Ee,{modelValue:Ae.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Ae.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),P(A,null,{default:q(()=>[P(z,{type:"primary",onClick:Xe},{default:q(()=>[P(x,null,{default:q(()=>[P(O(f))]),_:1}),a[29]||(a[29]=B(" 搜索 ",-1))]),_:1}),P(z,{onClick:Ze},{default:q(()=>[P(x,null,{default:q(()=>[P(O(b))]),_:1}),a[30]||(a[30]=B(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),S("div",Ve,[G((L(),H(va,{data:ze.value,stripe:"",border:"",style:{width:"100%"}},{default:q(()=>[P(We,{prop:"feeName",label:"费用名称",width:"120","show-overflow-tooltip":""}),P(We,{prop:"feeTypeName",label:"费用类型",width:"100"},{default:q(({row:e})=>[P(da,{type:Ke(e.feeType)},{default:q(()=>[B(R(e.feeTypeName),1)]),_:2},1032,["type"])]),_:1}),P(We,{prop:"studentName",label:"学生姓名",width:"100"}),P(We,{prop:"studentNo",label:"学号",width:"120"}),P(We,{prop:"roomNo",label:"宿舍号",width:"100"}),P(We,{prop:"amount",label:"费用金额",width:"120",align:"right"},{default:q(({row:e})=>{var a;return[S("span",ke,"¥"+R((null==(a=e.amount)?void 0:a.toFixed(2))||"0.00"),1)]}),_:1}),P(We,{prop:"paidAmount",label:"已付金额",width:"120",align:"right"},{default:q(({row:e})=>{var a;return[S("span",Ce,"¥"+R((null==(a=e.paidAmount)?void 0:a.toFixed(2))||"0.00"),1)]}),_:1}),P(We,{prop:"unpaidAmount",label:"未付金额",width:"120",align:"right"},{default:q(({row:e})=>{var a;return[S("span",$e,"¥"+R((null==(a=e.unpaidAmount)?void 0:a.toFixed(2))||"0.00"),1)]}),_:1}),P(We,{prop:"paymentStatusName",label:"支付状态",width:"100",align:"center"},{default:q(({row:e})=>[P(da,{type:Le(e.paymentStatus)},{default:q(()=>[B(R(e.paymentStatusName),1)]),_:2},1032,["type"])]),_:1}),P(We,{prop:"dueDate",label:"截止日期",width:"120"}),P(We,{prop:"createTime",label:"创建时间",width:"160"}),P(We,{label:"操作",width:"200",fixed:"right"},{default:q(({row:e})=>[P(pa,null,{default:q(()=>[P(z,{size:"small",onClick:a=>(e=>{var a,l,t;const u=`\n费用名称: ${e.feeName}\n费用类型: ${e.feeTypeName}\n学生姓名: ${e.studentName||"-"}\n学号: ${e.studentNo||"-"}\n宿舍号: ${e.roomNo||"-"}\n费用金额: ¥${(null==(a=e.amount)?void 0:a.toFixed(2))||"0.00"}\n已付金额: ¥${(null==(l=e.paidAmount)?void 0:l.toFixed(2))||"0.00"}\n未付金额: ¥${(null==(t=e.unpaidAmount)?void 0:t.toFixed(2))||"0.00"}\n支付状态: ${e.paymentStatusName}\n截止日期: ${e.dueDate||"-"}\n创建时间: ${e.createTime}\n  `.trim();T.info(u)})(e)},{default:q(()=>[P(x,null,{default:q(()=>[P(O(N))]),_:1})]),_:1},8,["onClick"]),P(z,{size:"small",type:"primary",onClick:a=>ta(e)},{default:q(()=>[P(x,null,{default:q(()=>[P(O(w))]),_:1})]),_:1},8,["onClick"]),2!==e.paymentStatus?(L(),H(z,{key:0,size:"small",type:"success",onClick:a=>ua(e)},{default:q(()=>[P(x,null,{default:q(()=>[P(O(l))]),_:1})]),_:1},8,["onClick"])):K("",!0),P(z,{size:"small",type:"danger",onClick:a=>oa(e)},{default:q(()=>[P(x,null,{default:q(()=>[P(O(V))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ga,I.value]]),S("div",Te,[S("div",xe,[P(fa,{"current-page":je.current,"onUpdate:currentPage":a[6]||(a[6]=e=>je.current=e),"page-size":je.size,"onUpdate:pageSize":a[7]||(a[7]=e=>je.size=e),"page-sizes":[10,20,50,100],total:je.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:aa,onCurrentChange:ea},null,8,["current-page","page-size","total"])])])])]),P(ya,{modelValue:Be.value,"onUpdate:modelValue":a[21]||(a[21]=e=>Be.value=e),title:qe.value,width:"600px",onClose:na},{footer:q(()=>[S("div",Ye,[P(z,{onClick:a[20]||(a[20]=e=>Be.value=!1)},{default:q(()=>[...a[31]||(a[31]=[B("取消",-1)])]),_:1}),P(z,{type:"primary",onClick:ca,loading:De.value},{default:q(()=>[...a[32]||(a[32]=[B(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:q(()=>[P(Qe,{ref_key:"formRef",ref:Oe,model:Je,rules:He,"label-width":"100px"},{default:q(()=>[P(A,{label:"费用类型",prop:"feeType"},{default:q(()=>[P(Re,{modelValue:Je.feeType,"onUpdate:modelValue":a[8]||(a[8]=e=>Je.feeType=e),placeholder:"请选择费用类型",style:{width:"100%"}},{default:q(()=>[(L(!0),M(E,null,J(O(Q),e=>(L(),H(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),P(A,{label:"费用名称",prop:"feeName"},{default:q(()=>[P(j,{modelValue:Je.feeName,"onUpdate:modelValue":a[9]||(a[9]=e=>Je.feeName=e),placeholder:"请输入费用名称"},null,8,["modelValue"])]),_:1}),P(A,{label:"费用描述"},{default:q(()=>[P(j,{modelValue:Je.description,"onUpdate:modelValue":a[10]||(a[10]=e=>Je.description=e),type:"textarea",rows:2,placeholder:"请输入费用描述"},null,8,["modelValue"])]),_:1}),P(A,{label:"费用金额",prop:"amount"},{default:q(()=>[P(ba,{modelValue:Je.amount,"onUpdate:modelValue":a[11]||(a[11]=e=>Je.amount=e),min:0,precision:2,style:{width:"100%"},placeholder:"请输入费用金额"},null,8,["modelValue"])]),_:1}),P(A,{label:"计费周期",prop:"billingCycle"},{default:q(()=>[P(Re,{modelValue:Je.billingCycle,"onUpdate:modelValue":a[12]||(a[12]=e=>Je.billingCycle=e),placeholder:"请选择计费周期",style:{width:"100%"}},{default:q(()=>[(L(!0),M(E,null,J(O(W),e=>(L(),H(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),P(A,{label:"学生信息"},{default:q(()=>[P(Re,{modelValue:Je.studentId,"onUpdate:modelValue":a[13]||(a[13]=e=>Je.studentId=e),placeholder:"请选择学生",filterable:"",remote:"","reserve-keyword":"","remote-method":sa,loading:Fe.value,style:{width:"100%"},onChange:ia,onFocus:a[14]||(a[14]=e=>sa("")),clearable:""},{default:q(()=>[(L(!0),M(E,null,J(Se.value,e=>(L(),H(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),P(A,{label:"宿舍信息"},{default:q(()=>[P(Re,{modelValue:Je.roomId,"onUpdate:modelValue":a[15]||(a[15]=e=>Je.roomId=e),placeholder:"请选择宿舍",filterable:"",remote:"","reserve-keyword":"","remote-method":ra,loading:Me.value,style:{width:"100%"},onChange:ma,onFocus:a[16]||(a[16]=e=>ra("")),clearable:""},{default:q(()=>[(L(!0),M(E,null,J(Pe.value,e=>(L(),H(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),P(A,{label:"费用期间"},{default:q(()=>[P(Ee,{modelValue:Ge.value,"onUpdate:modelValue":a[17]||(a[17]=e=>Ge.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),P(A,{label:"截止日期"},{default:q(()=>[P(Ee,{modelValue:Je.dueDate,"onUpdate:modelValue":a[18]||(a[18]=e=>Je.dueDate=e),type:"date",placeholder:"请选择截止日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),P(A,{label:"备注"},{default:q(()=>[P(j,{modelValue:Je.remark,"onUpdate:modelValue":a[19]||(a[19]=e=>Je.remark=e),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-00a17539"]]);export{De as default};
