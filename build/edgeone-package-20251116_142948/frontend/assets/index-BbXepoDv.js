const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-c-Bn8k9l.js","assets/_plugin-vue_export-helper-g1HmYxY9.js","assets/_plugin-vue_export-helper-BYxgutQ6.css","assets/vendor-D1RP7qex.js","assets/logo-placeholder-BJ7lI4wk.js","assets/element-CivdSU1D.js","assets/utils-BstTJ5dP.js","assets/index-Dh4WPbdX.css","assets/el-input-D5lyFUI6.css","assets/index-DnGdyg-f.js","assets/index-B4kZYkcf.css","assets/el-scrollbar-CdjnQplT.css","assets/index-BbllKHrJ.js","assets/index-hsSQXrQ7.css","assets/el-card-CcLCrim4.css","assets/el-col-Ds2mGN2S.css","assets/index-WK-1kJpK.js","assets/error-handler-BugTZKHc.js","assets/index-DamK2zNw.css","assets/el-descriptions-item-o9ObloqJ.css","assets/el-table-column-KCVRPPOC.css","assets/el-input-number-D6iOyBgb.css","assets/index-DQLDlcxY.js","assets/index-CUAp2K5u.css","assets/el-date-picker-panel-C-Zz6Fhi.css","assets/index-BUJNlmO2.js","assets/index-4HNrjLwZ.css","assets/el-radio-group-Bc0vNHmC.css","assets/index-6QCXaLH3.js","assets/index-D5jWSi7_.css","assets/index-w87Etpe4.js","assets/index-ozaVOfx7.css","assets/index-B-uFYUh5.js","assets/visitor-BE84VSQc.js","assets/index-fUGrVQSu.css","assets/index-C_0GCb5y.js","assets/index-6Xmqr6Ng.css"])))=>i.map(i=>d[i]);
import{y as e,z as t,R as o,J as r,u as n,al as a,A as s,ax as i,r as l,c,ay as u,az as m,au as d,aA as p}from"./vendor-D1RP7qex.js";import{E as h,a as f,b as g,i as v}from"./element-CivdSU1D.js";import{a as _}from"./utils-BstTJ5dP.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var E={name:"zh-cn",el:{breadcrumb:{label:"面包屑"},colorpicker:{confirm:"确定",clear:"清空",defaultLabel:"颜色选择器",description:"当前颜色 {color}，按 Enter 键选择新颜色",alphaLabel:"选择透明度的值",alphaDescription:"透明度 {alpha}, 当前颜色 {color}",hueLabel:"选择色相值",hueDescription:"色相 {hue}, 当前颜色 {color}",svLabel:"选择饱和度与明度的值",svDescription:"饱和度 {saturation}, 明度 {brightness}, 当前颜色 {color}",predefineDescription:"选择 {value} 作为颜色"},datepicker:{now:"此刻",today:"今天",cancel:"取消",clear:"清空",confirm:"确定",dateTablePrompt:"使用方向键与 Enter 键可选择日期",monthTablePrompt:"使用方向键与 Enter 键可选择月份",yearTablePrompt:"使用方向键与 Enter 键可选择年份",selectedDate:"已选日期",selectDate:"选择日期",selectTime:"选择时间",startDate:"开始日期",startTime:"开始时间",endDate:"结束日期",endTime:"结束时间",prevYear:"前一年",nextYear:"后一年",prevMonth:"上个月",nextMonth:"下个月",year:"年",month1:"1 月",month2:"2 月",month3:"3 月",month4:"4 月",month5:"5 月",month6:"6 月",month7:"7 月",month8:"8 月",month9:"9 月",month10:"10 月",month11:"11 月",month12:"12 月",weeks:{sun:"日",mon:"一",tue:"二",wed:"三",thu:"四",fri:"五",sat:"六"},weeksFull:{sun:"星期日",mon:"星期一",tue:"星期二",wed:"星期三",thu:"星期四",fri:"星期五",sat:"星期六"},months:{jan:"一月",feb:"二月",mar:"三月",apr:"四月",may:"五月",jun:"六月",jul:"七月",aug:"八月",sep:"九月",oct:"十月",nov:"十一月",dec:"十二月"}},inputNumber:{decrease:"减少数值",increase:"增加数值"},select:{loading:"加载中",noMatch:"无匹配数据",noData:"无数据",placeholder:"请选择"},mention:{loading:"加载中"},dropdown:{toggleDropdown:"切换下拉选项"},cascader:{noMatch:"无匹配数据",loading:"加载中",placeholder:"请选择",noData:"暂无数据"},pagination:{goto:"前往",pagesize:"条/页",total:"共 {total} 条",pageClassifier:"页",page:"页",prev:"上一页",next:"下一页",currentPage:"第 {pager} 页",prevPages:"向前 {pager} 页",nextPages:"向后 {pager} 页",deprecationWarning:"你使用了一些已被废弃的用法，请参考 el-pagination 的官方文档"},dialog:{close:"关闭此对话框"},drawer:{close:"关闭此对话框"},messagebox:{title:"提示",confirm:"确定",cancel:"取消",error:"输入的数据不合法!",close:"关闭此对话框"},upload:{deleteTip:"按 Delete 键可删除",delete:"删除",preview:"查看图片",continue:"继续上传"},slider:{defaultLabel:"滑块介于 {min} 至 {max}",defaultRangeStartLabel:"选择起始值",defaultRangeEndLabel:"选择结束值"},table:{emptyText:"暂无数据",confirmFilter:"筛选",resetFilter:"重置",clearFilter:"全部",sumText:"合计"},tour:{next:"下一步",previous:"上一步",finish:"结束导览",close:"关闭此对话框"},tree:{emptyText:"暂无数据"},transfer:{noMatch:"无匹配数据",noData:"无数据",titles:["列表 1","列表 2"],filterPlaceholder:"请输入搜索内容",noCheckedFormat:"共 {total} 项",hasCheckedFormat:"已选 {checked}/{total} 项"},image:{error:"加载失败"},pageHeader:{title:"返回"},popconfirm:{confirmButtonText:"确定",cancelButtonText:"取消"},carousel:{leftArrow:"上一张幻灯片",rightArrow:"下一张幻灯片",indicator:"幻灯片切换至索引 {index}"}}};const w={id:"app"},y=e({__name:"App",setup:e=>(e,i)=>{const l=a("router-view"),c=h;return s(),t("div",w,[o(c,{locale:n(E)},{default:r(()=>[o(l)]),_:1},8,["locale"])])}}),k={},b=function(e,t,o){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),o=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in k)return;k[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,o&&n.setAttribute("nonce",o),document.head.appendChild(n),t?new Promise((t,o)=>{n.addEventListener("load",t),n.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},I=_.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json;charset=utf-8"}});I.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),I.interceptors.response.use(e=>{const{code:t,message:o,data:r}=e.data;return 200===t?r:Promise.reject(new Error(o||"请求失败"))},e=>{const{response:t}=e;if(t){const{status:e,data:o}=t;let r="请求失败";switch(o&&"object"==typeof o&&o.message&&(r=o.message),e){case 401:localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("refreshToken"),f.error("登录已过期，请重新登录"),window.location.href="/login";break;case 403:r=r||"权限不足";break;case 404:r=r||"请求的资源不存在";break;case 500:r=r||"服务器内部错误";break;default:r=r||`请求失败，状态码：${e}`}return Promise.reject(new Error(r))}return"ECONNABORTED"===e.code?Promise.reject(new Error("请求超时，请检查网络连接")):Promise.reject(new Error("网络错误，请检查网络连接"))});const T={get:(e,t)=>I.get(e,t),post:(e,t,o)=>I.post(e,t,o),put:(e,t,o)=>I.put(e,t,o),delete:(e,t)=>I.delete(e,t),patch:(e,t,o)=>I.patch(e,t,o)};const L=i("user",()=>{const e=l(localStorage.getItem("token")||""),t=l(localStorage.getItem("refreshToken")||""),o=l(localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):null),r=l(!1),n=c(()=>!!e.value),a=c(()=>{var e;return"admin"===(null==(e=o.value)?void 0:e.role)});async function s(){try{await T.post("/user/logout")}catch(r){}e.value="",t.value="",o.value=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo")}async function i(){try{const e=await T.get("/user/info");o.value=e,localStorage.setItem("userInfo",JSON.stringify(e))}catch(e){throw new Error(e.message||"获取用户信息失败")}}async function u(){try{if(!t.value)throw new Error("没有刷新Token");r.value=!0;const n=await(o=t.value,T.post("/user/refresh",null,{params:{refreshToken:o}}));return e.value=n.token,t.value=n.refreshToken,localStorage.setItem("token",n.token),localStorage.setItem("refreshToken",n.refreshToken),!0}catch(n){throw await s(),new Error("Token刷新失败，请重新登录")}finally{r.value=!1}var o}return{token:e,refreshToken:t,userInfo:o,loading:r,isLoggedIn:n,isAdmin:a,handleLogin:async function(o){try{r.value=!0;const a=await(n=o,T.post("/user/login",n));return e.value=a.token,t.value=a.refreshToken,localStorage.setItem("token",a.token),localStorage.setItem("refreshToken",a.refreshToken),await i(),!0}catch(a){throw new Error(a.message||"登录失败")}finally{r.value=!1}var n},handleLogout:s,fetchUserInfo:i,refreshAccessToken:u,initUserInfo:async function(){if(e.value&&!o.value)try{await i()}catch(t){try{await u(),await i()}catch(r){await s()}}}}}),P=[{path:"/login",name:"Login",component:()=>b(()=>import("./index-c-Bn8k9l.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),meta:{title:"登录",requiresAuth:!1}},{path:"/",name:"Layout",component:()=>b(()=>import("./index-DnGdyg-f.js"),__vite__mapDeps([9,1,2,4,3,5,6,10,11])),redirect:"/dashboard",meta:{requiresAuth:!0},children:[{path:"dashboard",name:"Dashboard",component:()=>b(()=>import("./index-BbllKHrJ.js"),__vite__mapDeps([12,1,2,5,3,6,13,14,15])),meta:{title:"首页",icon:"dashboard-outline"}},{path:"dormitory",name:"Dormitory",component:()=>b(()=>import("./index-WK-1kJpK.js"),__vite__mapDeps([16,1,2,17,5,3,6,18,14,19,20,15,11,8,21])),meta:{title:"宿舍与楼栋管理",icon:"home-outline"}},{path:"student",name:"Student",component:()=>b(()=>import("./index-DQLDlcxY.js"),__vite__mapDeps([22,1,2,3,5,17,6,23,14,19,20,24,8,11,15])),meta:{title:"学生管理",icon:"people-outline"}},{path:"checkin",name:"Checkin",component:()=>b(()=>import("./index-BUJNlmO2.js"),__vite__mapDeps([25,1,2,5,3,6,26,14,19,27,20,8,11,24])),meta:{title:"入住管理",icon:"log-in-outline"}},{path:"repair",name:"Repair",component:()=>b(()=>import("./index-6QCXaLH3.js"),__vite__mapDeps([28,1,2,5,3,6,29,14,19,27,20,11,8,24,15])),meta:{title:"报修管理",icon:"build-outline"}},{path:"inspection",name:"Inspection",component:()=>b(()=>import("./index-w87Etpe4.js"),__vite__mapDeps([30,1,2,5,3,6,31,14,19,20,8,21,11,24,15])),meta:{title:"卫生检查",icon:"clipboard-outline"}},{path:"visitor",name:"Visitor",component:()=>b(()=>import("./index-B-uFYUh5.js"),__vite__mapDeps([32,1,2,5,3,33,6,34,14,19,20,11,8,24,15])),meta:{title:"访客登记",icon:"person-add-outline"}},{path:"fee",name:"Fee",component:()=>b(()=>import("./index-C_0GCb5y.js"),__vite__mapDeps([35,1,2,5,3,33,6,36,14,20,8,21,11,24])),meta:{title:"费用管理",icon:"card-outline"}}]}],D=u({history:m(),routes:P});D.beforeEach((e,t,o)=>{const r=L();e.meta.requiresAuth&&!r.isLoggedIn?o("/login"):"/login"===e.path&&r.isLoggedIn?o("/"):o()});const S=d(y);for(const[j,x]of Object.entries(g))S.component(j,x);S.use(p()),S.use(D),S.use(v,{size:"default"}),S.mount("#app");export{T as r,I as s,L as u};
