import{r as e}from"./index-BbXepoDv.js";/* empty css                *//* empty css                             *//* empty css                        *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                        */import{_ as l}from"./_plugin-vue_export-helper-g1HmYxY9.js";import{u as a}from"./error-handler-BugTZKHc.js";import{K as t,j as o,R as u,e as s,f as r,c as d,d as i,S as n,T as p,U as m,V as c,W as b,J as f,H as g,X as v,Y as _,Z as N,_ as h,$ as y,a0 as w,a1 as V,a2 as x,a3 as k,P as z,M as B,a4 as j,a5 as U,a6 as C,a7 as $,a as I,G as T}from"./element-CivdSU1D.js";import{y as q,r as A,l as O,c as S,w as P,j as R,z as J,B as K,R as Z,O as E,J as F,u as G,K as H,I as L,P as M,L as Q,Q as W,a5 as X,A as Y}from"./vendor-D1RP7qex.js";import"./utils-BstTJ5dP.js";function D(l){return e.get(`/dormitory/${l}`)}function ee(l){return e.post("/dormitory",l)}const le={class:"dormitory-management"},ae={class:"page-header"},te={class:"page-title"},oe={class:"page-actions"},ue={class:"content-container"},se={class:"dormitory-section"},re={class:"search-section"},de={class:"table-section"},ie={class:"pagination-section"},ne={class:"bed-info-display"},pe={class:"bed-list"},me={class:"bed-status"},ce={class:"dialog-footer"},be={key:0,class:"dormitory-info"},fe={class:"bed-list-section",style:{"margin-top":"20px"}},ge=l(q({__name:"index",setup(l){const{handleError:q,showSuccess:ge}=a(),ve=A(!1),_e=A(!1),Ne=A([]),he=A(!1),ye=A(!1),we=A(!1),Ve=A([]),xe=A(null),ke=O({buildingNo:"",roomNo:"",floorNumber:void 0,status:void 0}),ze=O({bedInfos:[],buildingName:"",buildingNo:"",floorNumber:0,roomNo:""}),Be=A(4),je=O({current:1,size:10,total:0}),Ue=A(),Ce=S(()=>ye.value?"编辑宿舍":"新增宿舍"),$e={buildingNo:[{required:!0,message:"请输入楼栋号",trigger:"blur"},{pattern:/^[A-Z]\d*$/,message:"楼栋号格式不正确，如：A1",trigger:"blur"}],buildingName:[{required:!0,message:"请输入楼栋名称",trigger:"blur"},{min:2,max:50,message:"楼栋名称长度应在2-50个字符之间",trigger:"blur"}],roomNo:[{required:!0,message:"请输入房间号",trigger:"blur"},{pattern:/^\d{1,4}$/,message:"房间号格式不正确",trigger:"blur"}],floorNumber:[{required:!0,message:"请输入楼层",trigger:"blur"},{type:"number",min:1,max:30,message:"楼层应在1-30之间",trigger:"blur"}],floorCount:[{required:!0,message:"请输入楼层数",trigger:"blur"},{type:"number",min:1,max:30,message:"楼层数应在1-30之间",trigger:"blur"}],bedInfos:[{required:!0,message:"床位信息不能为空",trigger:"change"}],description:[{max:200,message:"描述长度不能超过200个字符",trigger:"blur"}]},Ie=async()=>{ve.value=!0;try{const l={current:je.current,size:je.size,buildingNo:ke.buildingNo||void 0,roomNo:ke.roomNo||void 0,floorNumber:ke.floorNumber,status:ke.status},a=await function(l){return e.post("/dormitory/page",l)}(l);Ne.value=a.records,je.total=a.total}catch(l){q(l,"获取数据失败")}finally{ve.value=!1}},Te=()=>{je.current=1,Ie()},qe=()=>{ke.buildingNo="",ke.roomNo="",ke.floorNumber=void 0,ke.status=void 0,je.current=1,Ie()},Ae=e=>{je.size=e,je.current=1,Ie()},Oe=e=>{je.current=e,Ie()},Se=()=>{ye.value=!1,he.value=!0,Ee()},Pe=l=>{T.confirm(`确定要删除宿舍"${l.buildingName}${l.roomNo}"吗？此操作不可恢复！`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(a=l.id,e.delete(`/dormitory/${a}`)),ge("删除成功"),Ie()}catch(t){q(t,"删除失败")}var a})},Re=l=>{const a=1===l.status?"停用":"启用";T.confirm(`确定要${a}宿舍"${l.buildingName}${l.roomNo}"吗？`,`${a}确认`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(t=l.id,o=1===l.status?2:1,e.get("/dormitory/status",{params:{id:t,status:o}})),ge(`${a}成功`),Ie()}catch(u){q(u,`${a}失败`)}var t,o})},Je=e=>{const l=[];for(let a=1;a<=e;a++)l.push({isOccupied:!1,statusText:"",bedNo:`${a}号床`,status:1,description:""});return l};P(Be,e=>{e&&e>0&&(ze.bedInfos=Je(e))},{immediate:!0});const Ke=async()=>{if(Ue.value)try{await Ue.value.validate(),_e.value=!0,ye.value?(await ee(ze),ge("更新成功")):(await ee(ze),ge("创建成功")),he.value=!1,Ie()}catch(e){q(e,ye.value?"更新失败":"创建失败")}finally{_e.value=!1}},Ze=()=>{he.value=!1,Ee()},Ee=()=>{Ue.value&&Ue.value.resetFields(),Be.value=4,Object.assign(ze,{id:"",buildingNo:"",roomNo:"",buildingName:"",floorNumber:1,bedInfos:Je(4),description:""})},Fe=e=>{switch(e){case 1:return"success";case 0:return"danger";case 2:return"warning";default:return"info"}},Ge=e=>{switch(e){case 1:return"可用";case 0:return"已满";case 2:return"维护";default:return"未知"}},He=e=>{switch(e){case 1:return"success";case 2:return"warning";default:return"info"}},Le=e=>{switch(e){case 1:return"可用";case 2:return"已占用";default:return"未知"}};return R(()=>{Ie()}),(e,l)=>{const a=o,T=s,A=i,O=d,S=n,P=m,R=p,ee=r,ge=f,Ie=v,Ee=_,Me=N,Qe=$,We=k,Xe=B,Ye=z,De=j,el=C,ll=U,al=g;return Y(),J("div",le,[K("div",ae,[K("div",te,[K("h2",null,[Z(a,null,{default:F(()=>[Z(G(t))]),_:1}),l[15]||(l[15]=E(" 宿舍与楼栋管理 ",-1))]),l[16]||(l[16]=K("p",null,"管理宿舍与楼栋信息等",-1))]),K("div",oe,[Z(T,{type:"primary",onClick:Se,size:"large"},{default:F(()=>[Z(a,null,{default:F(()=>[Z(G(u))]),_:1}),l[17]||(l[17]=E(" 新增宿舍 ",-1))]),_:1})])]),K("div",ue,[K("div",se,[K("div",re,[Z(ge,{shadow:"never"},{default:F(()=>[Z(ee,{model:ke,inline:"",class:"search-form"},{default:F(()=>[Z(O,{label:"楼栋号"},{default:F(()=>[Z(A,{modelValue:ke.buildingNo,"onUpdate:modelValue":l[0]||(l[0]=e=>ke.buildingNo=e),placeholder:"请输入楼栋号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),Z(O,{label:"房间号"},{default:F(()=>[Z(A,{modelValue:ke.roomNo,"onUpdate:modelValue":l[1]||(l[1]=e=>ke.roomNo=e),placeholder:"请输入房间号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),Z(O,{label:"楼层"},{default:F(()=>[Z(S,{modelValue:ke.floorNumber,"onUpdate:modelValue":l[2]||(l[2]=e=>ke.floorNumber=e),min:1,max:30,placeholder:"请输入楼层",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),Z(O,{label:"状态"},{default:F(()=>[Z(R,{modelValue:ke.status,"onUpdate:modelValue":l[3]||(l[3]=e=>ke.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:F(()=>[Z(P,{label:"可用",value:1}),Z(P,{label:"已满",value:0}),Z(P,{label:"维护",value:2})]),_:1},8,["modelValue"])]),_:1}),Z(O,null,{default:F(()=>[Z(T,{type:"primary",onClick:Te},{default:F(()=>[Z(a,null,{default:F(()=>[Z(G(c))]),_:1}),l[18]||(l[18]=E(" 搜索 ",-1))]),_:1}),Z(T,{onClick:qe},{default:F(()=>[Z(a,null,{default:F(()=>[Z(G(b))]),_:1}),l[19]||(l[19]=E(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),K("div",de,[H((Y(),L(Qe,{data:Ne.value,stripe:"",border:"",style:{width:"100%"}},{default:F(()=>[Z(Ie,{prop:"buildingNo",label:"楼栋号",width:"100"}),Z(Ie,{prop:"buildingName",label:"楼栋名称",width:"120"}),Z(Ie,{prop:"roomNo",label:"房间号",width:"100"}),Z(Ie,{prop:"floorNumber",label:"楼层",width:"80",align:"center"}),Z(Ie,{prop:"totalBeds",label:"床位数",width:"80",align:"center"}),Z(Ie,{prop:"occupiedBeds",label:"已入住",width:"80",align:"center"}),Z(Ie,{prop:"availableBeds",label:"空床位",width:"80",align:"center"},{default:F(({row:e})=>[Z(Ee,{type:e.availableBeds>0?"success":"danger"},{default:F(()=>[E(M(e.availableBeds),1)]),_:2},1032,["type"])]),_:1}),Z(Ie,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),Z(Ie,{prop:"status",label:"状态",width:"100",align:"center"},{default:F(({row:e})=>[Z(Ee,{type:Fe(e.status)},{default:F(()=>[E(M(Ge(e.status)),1)]),_:2},1032,["type"])]),_:1}),Z(Ie,{prop:"createTime",label:"创建时间",width:"180"}),Z(Ie,{label:"操作",width:"320",fixed:"right"},{default:F(({row:e})=>[Z(Me,null,{default:F(()=>{return[Z(T,{size:"small",onClick:l=>(async e=>{var l;try{if(e.occupiedBeds>0)return void I.warning("该宿舍已有学生入住，无法编辑");ye.value=!0,he.value=!0;const a=await D(e.id);Be.value=a.totalBeds||4,Object.assign(ze,{id:e.id,buildingNo:e.buildingNo,buildingName:e.buildingName,roomNo:e.roomNo,floorNumber:e.floorNumber,bedInfos:(null==(l=a.bedInfos)?void 0:l.map(e=>({bedNo:e.bedNo,status:e.status,description:e.description||""})))||Je(Be.value),description:e.description||""})}catch(a){q(a,"获取宿舍详情失败")}})(e),disabled:e.occupiedBeds>0,title:e.occupiedBeds>0?"该宿舍已有学生入住，无法编辑":"编辑宿舍"},{default:F(()=>[Z(a,null,{default:F(()=>[Z(G(h))]),_:1})]),_:1},8,["onClick","disabled","title"]),Z(T,{size:"small",type:"info",onClick:l=>(async e=>{try{const l=await D(e.id);xe.value=l,Ve.value=l.bedInfos||[],we.value=!0}catch(l){q(l,"获取宿舍详情失败")}})(e)},{default:F(()=>[Z(a,null,{default:F(()=>[Z(G(y))]),_:1})]),_:1},8,["onClick"]),Z(T,{size:"small",disabled:e.occupiedBeds>0,type:(l=e.status,1===l?"warning":"success"),onClick:l=>Re(e)},{default:F(()=>[Z(a,null,{default:F(()=>[1!==e.status?(Y(),L(G(w),{key:0})):(Y(),L(G(V),{key:1}))]),_:2},1024)]),_:2},1032,["disabled","type","onClick"]),Z(T,{size:"small",type:"danger",onClick:l=>Pe(e),disabled:e.occupiedBeds>0,title:e.occupiedBeds>0?"该宿舍已有学生入住，无法删除":"删除宿舍"},{default:F(()=>[Z(a,null,{default:F(()=>[Z(G(x))]),_:1})]),_:1},8,["onClick","disabled","title"])];var l}),_:2},1024)]),_:1})]),_:1},8,["data"])),[[al,ve.value]]),K("div",ie,[Z(We,{"current-page":je.current,"onUpdate:currentPage":l[4]||(l[4]=e=>je.current=e),"page-size":je.size,"onUpdate:pageSize":l[5]||(l[5]=e=>je.size=e),"page-sizes":[10,20,50,100],total:je.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ae,onCurrentChange:Oe},null,8,["current-page","page-size","total"])])])])]),Z(De,{modelValue:he.value,"onUpdate:modelValue":l[13]||(l[13]=e=>he.value=e),title:Ce.value,width:"600px","before-close":Ze},{footer:F(()=>[K("span",ce,[Z(T,{onClick:l[12]||(l[12]=e=>he.value=!1)},{default:F(()=>[...l[20]||(l[20]=[E("取消",-1)])]),_:1}),Z(T,{type:"primary",onClick:Ke,loading:_e.value},{default:F(()=>[E(M(ye.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:F(()=>[Z(ee,{ref_key:"formRef",ref:Ue,model:ze,rules:$e,"label-width":"100px","label-position":"top"},{default:F(()=>[Z(Ye,{gutter:20},{default:F(()=>[Z(Xe,{span:8},{default:F(()=>[Z(O,{label:"楼栋号",prop:"buildingNo"},{default:F(()=>[Z(A,{modelValue:ze.buildingNo,"onUpdate:modelValue":l[6]||(l[6]=e=>ze.buildingNo=e),placeholder:"请输入楼栋号，如：A1"},null,8,["modelValue"])]),_:1})]),_:1}),Z(Xe,{span:8},{default:F(()=>[Z(O,{label:"楼栋名称",prop:"buildingName"},{default:F(()=>[Z(A,{modelValue:ze.buildingName,"onUpdate:modelValue":l[7]||(l[7]=e=>ze.buildingName=e),placeholder:"请输入楼栋名称，如：A1栋"},null,8,["modelValue"])]),_:1})]),_:1}),Z(Xe,{span:8},{default:F(()=>[Z(O,{label:"房间号",prop:"roomNo"},{default:F(()=>[Z(A,{modelValue:ze.roomNo,"onUpdate:modelValue":l[8]||(l[8]=e=>ze.roomNo=e),placeholder:"请输入房间号，如：101"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Z(Ye,{gutter:20},{default:F(()=>[Z(Xe,{span:12},{default:F(()=>[Z(O,{label:"楼层",prop:"floorNumber"},{default:F(()=>[Z(S,{modelValue:ze.floorNumber,"onUpdate:modelValue":l[9]||(l[9]=e=>ze.floorNumber=e),min:1,max:30,placeholder:"请输入楼层",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Z(Ye,{gutter:20},{default:F(()=>[Z(Xe,{span:12},{default:F(()=>[Z(O,{label:"床位数",prop:"bedInfos"},{default:F(()=>[Z(S,{modelValue:Be.value,"onUpdate:modelValue":l[10]||(l[10]=e=>Be.value=e),min:1,max:12,placeholder:"请输入床位数",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),ze.bedInfos.length>0?(Y(),L(O,{key:0,label:"床位信息"},{default:F(()=>[K("div",ne,[K("div",pe,[(Y(!0),J(W,null,X(ze.bedInfos,(e,l)=>(Y(),J("div",{key:l,class:"bed-item"},[Z(Ee,{type:1===e.status?"success":2===e.status?"danger":"warning",class:"bed-tag"},{default:F(()=>[E(M(e.bedNo)+" ",1),K("span",me,"("+M(1===e.status?"可用":"已占用")+")",1)]),_:2},1032,["type"]),Z(A,{modelValue:e.bedNo,"onUpdate:modelValue":l=>e.bedNo=l,placeholder:"床位号",size:"small",style:{width:"120px","margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),Z(R,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,size:"small",style:{width:"100px","margin-left":"5px"}},{default:F(()=>[Z(P,{label:"可用",value:1}),Z(P,{label:"已占用",value:2})]),_:1},8,["modelValue","onUpdate:modelValue"])]))),128))])])]),_:1})):Q("",!0),Z(O,{label:"描述",prop:"description"},{default:F(()=>[Z(A,{modelValue:ze.description,"onUpdate:modelValue":l[11]||(l[11]=e=>ze.description=e),type:"textarea",rows:3,placeholder:"请输入宿舍描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),Z(De,{modelValue:we.value,"onUpdate:modelValue":l[14]||(l[14]=e=>we.value=e),title:"床位信息",width:"800px"},{default:F(()=>[xe.value?(Y(),J("div",be,[Z(ll,{column:2,border:""},{default:F(()=>[Z(el,{label:"宿舍"},{default:F(()=>[E(M(xe.value.buildingName)+M(xe.value.roomNo),1)]),_:1}),Z(el,{label:"楼层"},{default:F(()=>[E(M(xe.value.floorNumber)+"层",1)]),_:1}),Z(el,{label:"总床位"},{default:F(()=>[E(M(xe.value.totalBeds)+"个",1)]),_:1}),Z(el,{label:"已入住"},{default:F(()=>[E(M(xe.value.occupiedBeds)+"个",1)]),_:1}),Z(el,{label:"空床位"},{default:F(()=>[E(M(xe.value.availableBeds)+"个",1)]),_:1}),Z(el,{label:"状态"},{default:F(()=>[Z(Ee,{type:Fe(xe.value.status)},{default:F(()=>[E(M(Ge(xe.value.status)),1)]),_:1},8,["type"])]),_:1})]),_:1})])):Q("",!0),K("div",fe,[l[21]||(l[21]=K("h4",null,"床位详情",-1)),Z(Qe,{data:Ve.value,border:"",style:{width:"100%"}},{default:F(()=>[Z(Ie,{prop:"bedNo",label:"床位号",width:"120"}),Z(Ie,{prop:"status",label:"床位状态",width:"100",align:"center"},{default:F(({row:e})=>[Z(Ee,{type:He(e.status)},{default:F(()=>[E(M(Le(e.status)),1)]),_:2},1032,["type"])]),_:1}),Z(Ie,{prop:"name",label:"入住学生"}),Z(Ie,{prop:"studentNo",label:"学号",width:"120"}),Z(Ie,{prop:"description",label:"备注"})]),_:1},8,["data"])])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-55a798e3"]]);export{ge as default};
